
<!-- saved from url=(0071)https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link rel="stylesheet" type="text/css" href="./sample_files/ivoa_doc.css">
<meta name="GENERATOR" content="TtH 3.80">
<title> SAMP --- Simple Application Messaging Protocol </title>
</head>
<body data-new-gr-c-s-check-loaded="14.1156.0" data-gr-ext-installed="">
<table cellspacing="0" cellpadding="0" width="450"><tbody><tr>
<td><a href="http://www.ivoa.net/"><img height="169" alt="IVOA" src="./sample_files/IVOA_wb_300.jpg" width="300" border="0"></a></td>
<td>
<div style="padding: 3.6pt 7.2pt;">
<p><b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);"><span>&nbsp;</span>I</span></i></b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);">nternational</span></i></p>
<p><b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);"><span>&nbsp;&nbsp;&nbsp;</span>V</span></i></b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);">irtual</span></i></p>
<p><b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);"><span>&nbsp;</span><span>&nbsp;&nbsp;</span>O</span></i></b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);">bservatory</span></i></p>
<p><b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);">A</span></i></b><i><span style="font-size: 14pt; color: rgb(0, 90, 156);">lliance</span></i><i></i></p>
</div>
<i></i>
</td>
</tr></tbody></table>
<br>
 
<h1 align="center">SAMP - Simple Application Messaging Protocol </h1>

<p></p>



<p></p>


<p></p>


<p></p>



<p></p>






<p></p>
   
                    <br><font size="+2"><font color="#00519C"><font face="helvetica"><b>Version 1.3</b></font></font></font>    <br><br><font size="+2"><font color="#00519C"><font face="helvetica"><b>IVOA Recommendation 2012-04-11</b></font></font></font>    <br><br><font size="+1">
    
<dl compact="">
<dt><b>This version:</b></dt>
	<dd> <font size="+0">1.3: Recommendation&nbsp;2012-04-11&nbsp;(Revision 1684)</font>
</dd>
 <dt><b>Latest version:</b></dt>
	<dd> <font size="+0"><a href="http://www.ivoa.net/Documents/latest/SAMP.html"><tt>http://www.ivoa.net/Documents/latest/SAMP.html</tt></a></font>
</dd>
 <dt><b>Previous versions:</b></dt>
	<dd> <font size="+0">
   1.0:  Working Draft 2008-06-25<br>
   1.11: Recommendation 2009-04-21 (Revision 987)<br>
   1.2:  Recommendation 2010-12-16 (Revision 1384)</font>
</dd>
 <dt><b>Working Group:</b></dt>
	<dd> Applications
</dd>
 <dt><b>Authors:</b></dt>
	<dd> M.&nbsp;Taylor (m.b.taylor@bristol.ac.uk)<br>
        T.&nbsp;Boch (boch@astro.u-strasbg.fr)<br>
        M.&nbsp;Fitzpatrick (fitz@noao.edu)<br>
        A.&nbsp;Allan (aa@astro.ex.ac.uk)<br>
        J.&nbsp;Fay (jfay@microsoft.com)<br>
        L.&nbsp;Paioro (luigi@lambrate.inaf.it)<br>
        J.&nbsp;Taylor (jontayler@gmail.com)<br>
        D.&nbsp;Tody (dtody@nrao.edu)
</dd>
 <dt><b>Editors:</b></dt>
	<dd> T.&nbsp;Boch, M.&nbsp;Fitzpatrick, M.&nbsp;Taylor
</dd>
</dl></font>

  
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  


<p></p>

<h2> Abstract</h2>
SAMP is a messaging protocol that enables astronomy software tools to 
interoperate and communicate.

<p></p>
IVOA members have recognised that building a monolithic tool 
that attempts to fulfil all 
the requirements of all users is impractical, and it is a better use of our 
limited resources to enable individual tools to work together better. 
One element of this is defining common file formats for the exchange of data 
between different applications. Another important component is a messaging 
system that enables the applications to share data and take advantage of each 
other's functionality.
SAMP supports communication between applications on the desktop
and in web browsers,
and is also intended to form a framework for more general messaging
requirements.

<p></p>

<h2>Status of this Document</h2>

<p></p>
This document has been produced by the IVOA Applications Working Group.
It has been reviewed by IVOA Members and other interested parties,
and has been endorsed by the IVOA Executive Committee as an IVOA
Recommendation.
It is a stable document and may be used as reference material or cited as
a normative reference from another document.  IVOA's role in making the
Recommendation is to draw attention to the specification and to promote
its widespread deployment.  This enhances the functionality and
interoperability inside the Astronomical Community.

<p></p>
Comments, questions and discussions relating to this document
may be posted to the mailing list of the SAMP subgroup of the 
Applications Working Group, 
<a href="mailto:apps-samp@ivoa.net">apps-samp@ivoa.net</a>.
Supporting material and further discussion
may be found at <a href="http://www.ivoa.net/samp/"><tt>http://www.ivoa.net/samp/</tt></a>.

<p></p>
Changes since earlier versions may be found in Appendix <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:changes">B</a>.

<p></p>

<h1>Contents </h1>
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1">1&nbsp; Introduction</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1.1">1.1&nbsp; Non-Technical Preamble and Position in IVOA Architecture</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1.2">1.2&nbsp; History</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1.3">1.3&nbsp; Requirements and Scope</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1.4">1.4&nbsp; Types of Messaging</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc1.5">1.5&nbsp; About this Document</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2">2&nbsp; Architectural Overview</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.1">2.1&nbsp; Nomenclature</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.2">2.2&nbsp; Messaging Topology</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.3">2.3&nbsp; The Lifecycle of a Client</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.4">2.4&nbsp; The Lifecycle of a Hub</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.5">2.5&nbsp; Message Delivery Patterns</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.6">2.6&nbsp; Extensible Vocabularies</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.7">2.7&nbsp; Use of Profiles</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc2.8">2.8&nbsp; Security Considerations</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3">3&nbsp; Abstract APIs and Data Types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.1">3.1&nbsp; Hub Discovery Mechanism</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.2">3.2&nbsp; Communicating with the Hub</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.3">3.3&nbsp; SAMP Data Types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.4">3.4&nbsp; Scalar Type Encoding Conventions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.5">3.5&nbsp; Registering with the Hub</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.6">3.6&nbsp; Application Metadata</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.7">3.7&nbsp; MType Subscriptions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.8">3.8&nbsp; Message Encoding</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.9">3.9&nbsp; Response Encoding</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.10">3.10&nbsp; Sending and Receiving Messages</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.11">3.11&nbsp; Operations a Hub Must Support</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.12">3.12&nbsp; Operations a Callable Client Must Support</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc3.13">3.13&nbsp; Error Processing</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4">4&nbsp; Standard Profile</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.1">4.1&nbsp; Data Type Mappings</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.2">4.2&nbsp; API Mappings</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.3">4.3&nbsp; Lockfile and Hub Discovery</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.3.1">4.3.1&nbsp; Lockfile Location</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.3.2">4.3.2&nbsp; Security Considerations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.3.3">4.3.3&nbsp; Lockfile Content</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.3.4">4.3.4&nbsp; Hub Discovery Sequences</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc4.4">4.4&nbsp; Examples</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5">5&nbsp; Web Profile</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.1">5.1&nbsp; Overview and Comparison with Standard Profile</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.1.1">5.1.1&nbsp; Hub Discovery</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.1.2">5.1.2&nbsp; Outward Communications</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.1.3">5.1.3&nbsp; Inward Communications</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.1.4">5.1.4&nbsp; Third-Party URLs</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2">5.2&nbsp; Hub Behaviour</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.1">5.2.1&nbsp; Data Type Mappings</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.2">5.2.2&nbsp; API Mappings</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.3">5.2.3&nbsp; Hub HTTP Server</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.4">5.2.4&nbsp; Registration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.5">5.2.5&nbsp; Callable Clients</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.2.6">5.2.6&nbsp; URL Translation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.3">5.3&nbsp; Client Behaviour</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4">5.4&nbsp; Security Considerations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.1">5.4.1&nbsp; Risk Analysis</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.2">5.4.2&nbsp; Registration Restrictions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.2.1">5.4.2.1&nbsp; Local Host Restriction</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.2.2">5.4.2.2&nbsp; User Confirmation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.2.3">5.4.2.3&nbsp; Client Authentication</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.3">5.4.3&nbsp; Behaviour Restrictions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.3.1">5.4.3.1&nbsp; MType Restrictions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.3.2">5.4.3.2&nbsp; URL Restrictions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc5.4.4">5.4.4&nbsp; Security Summary</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6">6&nbsp; MTypes: Message Semantics and Vocabulary</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.1">6.1&nbsp; The Form of an MType</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.2">6.2&nbsp; The Description of an MType</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.3">6.3&nbsp; MType Vocabulary: Extensibility and Process</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.4">6.4&nbsp; Core MTypes</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.4.1">6.4.1&nbsp; Hub Administrative Messages</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEc6.4.2">6.4.2&nbsp; Client Administrative Messages</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEcA">A&nbsp; Changes between PLASTIC and SAMP</a><br><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tth_sEcB">B&nbsp; Change History</a><br><p></p>
 <h2>
<a name="tth_sEc1">
1</a>&nbsp;&nbsp;Introduction</h2>

<p></p>
     <h3>
<a name="tth_sEc1.1">
1.1</a>&nbsp;&nbsp;Non-Technical Preamble and Position in IVOA Architecture</h3>
<a name="sect:nonTechPreamble">
</a>
SAMP, the Simple Application Messaging Protocol, is a standard
for allowing software tools to exchange control and data information,
thus facilitating tool interoperability, and so allowing users
to treat separately developed applications as an integrated suite.
An example of an operation that SAMP might facilitate is passing a
source catalogue from one GUI application to another, and 
subsequently allowing sources marked by the user in one of those 
applications to be visible as such in the other.

<p></p>
The protocol has been designed, and implementations developed, within
the context of the International Virtual Observatory Alliance (IVOA),
but the design is not specific either to the Virtual Observatory (VO)
or to Astronomy.  It is used in practice 
for both VO and non-VO work with astronomical tools, and is in  
principle suitable for non-astronomical purposes as well.

<p></p>
The SAMP standard itself is neither a dependent, nor a dependency,
of other VO standards, but it provides valuable glue between user-level
applications which perform different VO-related tasks, and hence
contributes to the integration of Virtual Observatory functionality
from a user's point of view.
Figure&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#fig:ivoa-archi">1</a> illustrates SAMP in the context of the
IVOA Architecture [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#architecture">1</a>].
Most existing tools which operate in the 
User Layer of this architecture provide SAMP interoperability.

<p></p>
<a name="tth_fIg1">
</a> 
<center>
<img src="./sample_files/ivoa-archi.gif" alt="ivoa-archi.gif"><center>Figure 1: IVOA Architecture diagram [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#architecture">1</a>].
The SAMP protocol appears in the "Using" region.</center>
<a name="fig:ivoa-archi">
</a>
</center>

<p></p>
The semantics of messages that can be exchanged using SAMP are defined
by contracts known as MTypes (message-types), which are defined
by developer agreement outside of this standard.  The list of MTypes
used for common astronomical and VO purposes can be found near 
<a href="http://www.ivoa.net/samp/"><tt>http://www.ivoa.net/samp/</tt></a>; many of these make use of standards from 
elsewhere in the IVOA Architecture, including VOTable, VOResource, 
Simple Spectral Access, UCD and Utype.

<p></p>
     <h3>
<a name="tth_sEc1.2">
1.2</a>&nbsp;&nbsp;History</h3>
SAMP, the Simple Application Messaging Protocol,
 is a direct descendent of the PLASTIC protocol, which in turn grew 
- in the European VOTech framework - 
from the interoperability work of the Aladin [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#2000A+AS..143...33B">2</a>] and 
VisIVO [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#2007HiA....14..622B">3</a>] teams. We also note the 
contribution of the team behind the earlier XPA protocol [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xpa">4</a>]. For more information 
on PLASTIC's history and purpose see the IVOA Note <em>PLASTIC - a protocol for 
desktop application interoperability</em> [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#plastic">5</a>]
and the PLASTIC SourceForge site [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#plastic-sf">6</a>].

<p></p>
SAMP has similar aims to PLASTIC, but 
incorporates lessons learnt from two years of practical experience and ideas 
from partners who were not involved in PLASTIC's initial design. 

<p></p>
Broadly speaking, SAMP is an abstract framework for
loosely-coupled, asynchronous, RPC-like and/or event-based communication,
based on a central service providing multi-directional publish/subscribe
message brokering.
The message semantics are extensible and use structured but weakly-typed data.
These concepts are expanded on below.
It attempts to make as few assumptions as possible about the transport
layer or programming language with which it is used.
It also defines a "Standard Profile" which specifies how to 
implement this framework using XML-RPC [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xmlrpc">7</a>] as the transport layer.
The result of combining this Standard Profile with the rest of the SAMP
standard is deliberately similar in design to PLASTIC,
and this has been largely successful in its intention of enabling
PLASTIC applications to be modified to use SAMP instead without great effort.
More recently (version 1.3) an additional "Web Profile" has been introduced,
in order to facilitate use of SAMP from web applications.

<p></p>
     <h3>
<a name="tth_sEc1.3">
1.3</a>&nbsp;&nbsp;Requirements and Scope</h3>
SAMP aims to be a simple and extensible protocol that is platform- and 
language-neutral. 
The emphasis is on a 
simple protocol with a very shallow learning curve in order to encourage
as many application authors as possible to adopt it.
SAMP is intended to do what you need most of the time. The SAMP authors 
believe that this is the best way to foster innovation and collaboration in
astronomy applications.

<p></p>
It is important to note therefore that SAMP's scope is reasonably modest; it is 
not intended to be the perfect messaging solution for all situations.
In particular SAMP itself has 
no support for transactions, security, or guaranteed message delivery 
or integrity.
However, by layering the SAMP architecture on top of suitable
messaging infrastructures such capabilities could be provided.
These possibilities are not discussed further in this document,
but the intention is to provide an architecture which is sufficiently
open to allow for such things in the future with little change to the
basics.

<p></p>
     <h3>
<a name="tth_sEc1.4">
1.4</a>&nbsp;&nbsp;Types of Messaging</h3>
<a name="sect:typeOfMsging">
</a>

<p></p>
        SAMP is currently targetted at inter-application desktop messaging
with the idea that the basic framework presented here is extensible to meet
future needs, and so it is beyond the scope of this document to outline the
many types of messaging systems in use today (these are covered in detail
in many other documents).  While based on established messaging models,
SAMP is in many ways a hybrid of several basic messaging concepts; the
protocol is however flexible enough that later versions should be able to
interact fairly easily with other messaging systems because of the shared
messaging models.

<p></p>
The messaging concepts used within SAMP include:

<p></p>

<dl compact="">
<dt><b>Publish/Subscribe Messaging:</b></dt>
	<dd>
    A publish/subscribe (pub/sub) messaging system supports an event driven
    model where information producers and consumers participate in message
    passing.  SAMP applications "publish" a message, while consumer
    applications "subscribe" to messages of interest and consume events.
    The underlying messaging system routes messages from producers 
    to consumers based on
    the message types in which an application has registered an interest.</dd>
 <dt><b>Point-to-Point Messaging:</b></dt>
	<dd>
    In point to point messaging systems, messages are routed to an
    individual consumer which maintains a queue of "incoming" messages.  In
    a traditional message queue, applications send messages to a specified
    queue and clients retrieve them.  In SAMP, the message system manages
    the delivery and routing of messages, but also permits the concept of a
    directed message meant for delivery to a specific application.  SAMP
    does not, however, guarantee the order of message delivery as with a
    traditional message queue.</dd>
 <dt><b>Event-based Messaging:</b></dt>
	<dd>
    Event-based systems are systems in which producers generate events, and in
    which messaging middleware delivers events to consumers based upon a
    previously specified interest.  One typical usage pattern of these systems
    is the publish/subscribe paradigm, however these systems are also widely
    used for integrating loosely coupled application components.  SAMP allows
    for the concept that an "event" occurred in the system and that these
    message types may have requirements different from messages where the
    sender is trying to invoke some action in the network of applications.</dd>
 <dt><b>Synchronous vs. Asynchronous Messaging:</b></dt>
	<dd>
    As the term is used in this document, a "synchronous" message is one
    which blocks the sending application from further processing until a
    reply is received.  However, SAMP messaging is based on "asynchronous"
    message and response in that the delivery of a message and its
    subsequent response are handled as separate activities by the
    underlying system.  With the exception of the synchronous message
    pattern supported by the system, sending or replying to a message using
    SAMP allows an application to return to other processing while the
    details of the delivery are handled separately.</dd>
</dl>
<p></p>
     <h3>
<a name="tth_sEc1.5">
1.5</a>&nbsp;&nbsp;About this Document</h3>
This document contains the following main sections describing the SAMP protocol
and how to use it.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:architecture">2</a>
covers the requirements, basic concepts and overall architecture of SAMP.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:apis">3</a> defines abstract (i.e.&nbsp;independent of language,
platform and transport protocol) interfaces which clients and hubs 
must offer to participate in SAMP messaging, along with data types
and encoding rules required to use them.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a>
explains how the abstract API can be mapped to specific network operations
to form an interoperable messaging system, and defines the "Standard Profile",
based on XML-RPC, which gives a particular set of such mappings
suitable for general purpose desktop applications.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:webprofile">5</a> defines the "Web Profile",
an alternative mapping suitable for web applications.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mtypes">6</a>
describes the use of the MType keys used to denote message semantics,
and outlines an MType vocabulary.

<p></p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" 
in this document are to be interpreted as described in RFC 2119 [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2119">8</a>].

<p></p>
 <h2>
<a name="tth_sEc2">
2</a>&nbsp;&nbsp;Architectural Overview</h2>
<a name="sect:architecture">
</a>
This section provides a high level view of the SAMP protocol.

<p></p>
     <h3>
<a name="tth_sEc2.1">
2.1</a>&nbsp;&nbsp;Nomenclature</h3>
In the text that follows these terms are used: 

<p></p>

<dl compact="">
<dt><b>Hub:</b></dt>
	<dd>
    A broker service for routing SAMP Messages.</dd>
 <dt><b>Client:</b></dt>
	<dd>
    An application that talks to a Hub using SAMP. May be a
    Sender, Recipient, or both.</dd>
 <dt><b>Sender:</b></dt>
	<dd>
    A Client that sends a SAMP Message to one or more
    Recipients via the Hub.</dd>
 <dt><b>Recipient:</b></dt>
	<dd>
    A Client that receives a SAMP Message from
    the Hub. This may have originated from another Client or from the
    Hub itself.</dd>
 <dt><b>Message:</b></dt>
	<dd>
    A communication sent from a Sender to a Recipient
    via a SAMP Hub.  Contains an MType and zero or more named parameters.
    May or may not provoke a Response.</dd>
 <dt><b>Response:</b></dt>
	<dd>
    A communication which may be returned from a Recipient to a Sender
    in reply to a previous Message.  A Response may contain returned values
    and/or error information.  In the terminology of this document,
    a Response is not itself a Message.  A Response is also known as a
    Reply in this document.</dd>
 <dt><b>MType:</b></dt>
	<dd>
    A string defining the semantics of a Message and of its arguments and
    return values (if any).  Every Message contains exactly one MType,
    and a Message is only delivered to Clients subscribed to that MType.</dd>
 <dt><b>Subscription:</b></dt>
	<dd>
    A Client is said to be Subscribed to a given MType if it has
    declared to the Hub that it is prepared to receive Messages
    with that MType.</dd>
 <dt><b>Callable Client:</b></dt>
	<dd>
    A Client to which the Hub is capable of performing callbacks.
    Clients are not obliged to be Callable, but only Callable Clients
    are able to receive Messages or asynchronous Responses.</dd>
 <dt><b>Broadcast:</b></dt>
	<dd>
    To send a SAMP Message to all Subscribed Clients 
    excluding the Sender.</dd>
 <dt><b>Profile:</b></dt>
	<dd>
    A set of rules which map the abstract API defined by SAMP to a set of
    I/O operations which may be used by Clients to send and receive
    actual Messages.</dd>
</dl>
<p></p>
     <h3>
<a name="tth_sEc2.2">
2.2</a>&nbsp;&nbsp;Messaging Topology</h3>
SAMP has a hub-based architecture (see Figure&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#fig:samp-archi">2</a>). The hub is a single service used to route all 
messages between clients. This makes application discovery more 
straightforward in that each client only needs to locate the hub, and the services
provided by the hub are intended to simplify the actions of the client. A disadvantage of this 
architecture is that the hub may be a message bottleneck and potential single point of failure. 
The former means that SAMP may not be suitable for extremely high
throughput requirements;
the latter may be mitigated by an appropriate strategy for hub restart if failure is likely.

<p></p>
<a name="tth_fIg2">
</a> 
<center>
<img src="./sample_files/samp-archi.gif" alt="samp-archi.gif"><center>Figure 2: The SAMP hub architecture</center>
<a name="fig:samp-archi">
</a>
</center>

<p></p>
Note that the hub is defined as a service interface which may have any of
a number of implementations.  It may be an independent application running as
a daemon, an adapter interface layered on top of an existing messaging
infrastructure, or a service provided by an application which is itself
one of the hub's clients.

<p></p>
     <h3>
<a name="tth_sEc2.3">
2.3</a>&nbsp;&nbsp;The Lifecycle of a Client</h3>

<p></p>
A SAMP client goes through the following phases: 

<ol type="1">
<li> Determine whether a hub is running by using the appropriate hub discovery 
    mechanism.
<div class="p"></div>
</li>

<li> If so, use the hub discovery mechanism to work out how to communicate
    with the hub.
<div class="p"></div>
</li>

<li> Register with the hub.
<div class="p"></div>
</li>

<li> Store metadata such as client name, description and icon in the 
    hub.
<div class="p"></div>
</li>

<li> Subscribe to a list of MTypes to define messages which may be 
    received.
<div class="p"></div>
</li>

<li> Interrogate the hub for metadata of other clients.
<div class="p"></div>
</li>

<li> Send and/or receive messages to/from other clients via the hub.
<div class="p"></div>
</li>

<li> Unregister with the hub.
<div class="p"></div>
</li>
</ol>
Phases 4-7 are all optional and may be repeated in any order. 

<p></p>
By subscribing to the MTypes described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hub-mtypes">6.4.1</a>
a client may, if it wishes, keep track of the details of other clients' 
registrations, metadata and subscriptions.

<p></p>
     <h3>
<a name="tth_sEc2.4">
2.4</a>&nbsp;&nbsp;The Lifecycle of a Hub</h3>
A SAMP hub goes through the following phases: 

<p></p>

<ol type="1">
<li> Locate any existing hub by using the appropriate hub discovery mechanism.
    
<ol type="a">
<li> Check whether the existing hub is alive.
<div class="p"></div>
</li>

<li> If so, exit.
<div class="p"></div>
</li>
</ol>
<div class="p"></div>
</li>

<li> If no hub is running, or a hub is found but is not 
    functioning, write/overwrite the hub discovery record and start up.
<div class="p"></div>
</li>

<li> Await client registrations. When a client makes a legal 
    registration, assign it a public ID,
    and add the client to the table of registered 
    clients under the public ID. Broadcast a message
    announcing the registration of a 
    new client.
<div class="p"></div>
</li>

<li> When a client stores metadata in the hub, broadcast a message 
    announcing the change
    and make the metadata available.
<div class="p"></div>
</li>

<li> When a client updates its list of subscribed MTypes, broadcast a 
    message announcing the change and make the subscription information
    available
<div class="p"></div>
</li>

<li> When the hub receives a message for relaying, pass it on to 
    appropriate recipients which are subscribed to the message's MType.
    Broadcast messages are sent to all 
    subscribed clients except the sender, messages with a specified recipient
    are sent to that recipient if it is subscribed.
<div class="p"></div>
</li>

<li> Await client unregistrations. When a client unregisters, broadcast 
    a message announcing the unregistration 
    and remove the client from the table of registered clients.
<div class="p"></div>
</li>

<li> If the hub is unable to communicate with a client, it may 
    unregister it as described in phase 7.
<div class="p"></div>
</li>

<li> When the hub is about to shutdown, broadcast a message to 
    all subscribed clients.
<div class="p"></div>
</li>

<li> Delete the hub discovery record.
<div class="p"></div>
</li>
</ol>
Phases 3-8 are responses to events which may occur 
multiple times and in any order.

<p></p>
The MTypes broadcast by the hub to inform clients of changes in its state
are given in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hub-mtypes">6.4.1</a>.

<p></p>
Readers should note that, given this scheme, race conditions may occur.
A client might for instance try to register with a hub which has just shut down,
or attempt to send to a recipient which has already unregistered.
Specific profiles MAY define best-practice rules in order to best manage these
conditions,
but in general clients should be aware that SAMP's lack of guaranteed
message delivery and timing means that unexpected conditions are possible.

<p></p>
     <h3>
<a name="tth_sEc2.5">
2.5</a>&nbsp;&nbsp;Message Delivery Patterns</h3>
<a name="sect:delivery-outline">
</a>

<p></p>
Messages can be sent according to three patterns, differing in 
whether and how a response is returned to the sender:

<ol type="1">
<li> Notification
<div class="p"></div>
</li>

<li> Asynchronous Call/Response
<div class="p"></div>
</li>

<li> Synchronous Call/Response
<div class="p"></div>
</li>
</ol>
The Notification pattern is strictly one-way while in the Call/Response
patterns the recipient returns a response to the sender.

<p></p>
If the sender expects to receive some useful data as a result of the
receiver's processing, or if it wishes to find out whether and
when the processing is completed, it should use one of the Call/Response
variants.  If on the other hand the sender has no interest in what
the recipient does with the message once it has been sent, it
may use the Notification pattern.  Notification, since it involves
no communication back from the recipient to the sender, uses
fewer resources.
Although typically "event"-type messages will be sent using Notify
and "request-for-information"-type messages will be sent using
Call/Response, the choice of which delivery pattern to use is
entirely distinct from the content of the message, and is up to
the sender; any message (MType) may be sent using any of the above
patterns.
Apart from the fact of returning or not returning a response,
the recipient SHOULD process messages in exactly the same way 
regardless of which pattern is used.

<p></p>
From the receiver's point of view there are only two cases:
Notification and Asynchronous Call/Response.
However, the hub provides a convenience
method which simulates a synchronous call from the sender's point of view.
The purpose of this is to simplify the use of the protocol
in situations such as scripting environments which cannot easily handle
callbacks.  However, it is RECOMMENDED to use the asynchronous pattern
where possible due to its greater robustness.

<p></p>
     <h3>
<a name="tth_sEc2.6">
2.6</a>&nbsp;&nbsp;Extensible Vocabularies</h3>
<a name="sect:vocab">
</a>

<p></p>
At several places in this document structured information is 
conveyed by use of a controlled but extensible vocabulary.
Some examples are the client metadata keys (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:app-metadata">3.6</a>),
message encoding keys (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>) and 
MType names (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mtypes">6</a>).

<p></p>
Wherever this pattern is used, the following rules apply.
This document defines certain well-known keys with defined meanings.
These may be OPTIONAL or REQUIRED as documented, but if present
MUST be used by clients and hubs in the way defined here.  
All such well-known keys start with the string "<tt>samp.</tt>".

<p></p>
Clients and hubs are however free to introduce and use non-well-known
keys as they see fit.  Any string may be used for such a non-standard key, 
with the restriction that it MUST NOT start with the prefix "<tt>samp.</tt>".
The prefix "<tt>x-samp.</tt>" has a special meaning as described below.

<p></p>
The general rule is that hubs and clients encountering keys which
they do not understand SHOULD ignore them, propagating them to 
downstream consumers if appropriate.
As far as possible, where new keys are introduced they SHOULD be
such that applications ignoring them will continue to behave
in a sensible way.

<p></p>
Hubs and clients are therefore able to communicate information 
additional to that defined in the current version of this document
without disruption to those which do not understand it.
This extensibility may be of use to applications which have mutual 
private requirements outside the scope of this specification,
or to enable experimentation with new features.
If the SAMP community finds such experiments useful,
future versions of this document may bring such functionality within
the SAMP specification itself by defining new keys in the 
"<tt>samp.</tt>" namespace.  The ways in which these vocabularies 
are used means that such extensions should be possible with 
minimal upheaval to the existing specification and implementations.

<p></p>
Non-well-known keys (those outside of the "<tt>samp</tt>" namespace)
fall into two categories:
those which are candidates for future incorporation into the SAMP
standard as well-known, and those which are not.
If developers are experimenting with keys which they hope or believe
may be incorporated into the SAMP standard as well-known at some time
in the future, they may use the special namespace "<tt>x-samp</tt>".
If a future version of the standard does incorporate such a key
as well-known, the prefix is simply changed from "<tt>x-samp.</tt>"
to "<tt>samp.</tt>".
Consumers of such keys SHOULD treat keys which differ only in the
substitution of the prefix "<tt>samp.</tt>" for "<tt>x-samp.</tt>" or
vice versa as if they have identical semantics,
so for instance a client application should treat the value of
a metadata item with key "<tt>x-samp.a.b</tt>"
 in exactly the same way as one with key "<tt>samp.a.b</tt>".
The "<tt>samp</tt>" and "<tt>x-samp</tt>" form of the same key
SHOULD NOT be presented in the same map.  If both are presented together,
the "<tt>samp</tt>" form MAY be considered to take precedence,
though any reasonable behaviour is permitted.
This scheme makes it easy to introduce new well-known keys
in a way which neither makes illicit use of the reserved "<tt>samp.</tt>"
namespace nor requires frequent updates to the SAMP standard,
and which places a minimum burden on application developers.
Lists of keys in the "<tt>x-samp</tt>" namespace under discussion
may be found near <a href="http://www.ivoa.net/samp/"><tt>http://www.ivoa.net/samp/</tt></a>.

<p></p>
     <h3>
<a name="tth_sEc2.7">
2.7</a>&nbsp;&nbsp;Use of Profiles</h3>
<a name="sect:profiles">
</a>

<p></p>
The design of SAMP is based on the abstract interfaces
defined in Section&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:apis">3</a>.  On its own however, this does
not include the detailed instructions required by application developers
to achieve interoperability.  To achieve that, application developers
must know how to map the operations in the abstract SAMP interfaces 
to specific I/O
(in most cases, network) operations.  It is these I/O operations
which actually form the communication between applications.
The rules defining this mapping from interface to I/O operations
are what constitute a SAMP "Profile"
(the term "Implementation" was considered for this purpose, but rejected
because it has too many overlapping meanings in this context).

<p></p>
There are two ways in which such a Profile can be specified as far as
client application developers are concerned:

<ol type="1">
<li> By describing exactly what bytes are to be sent using what wire
      protocols for each SAMP interface operation
<div class="p"></div>
</li>

<li> By providing one or more language-specific libraries with calls 
      which correspond to those of the SAMP interface
<div class="p"></div>
</li>
</ol>
Although either is possible, SAMP is well-suited for approach (1) above
given a suitable low-level transport library.
This is the case since the operations are quite low-level, 
so client applications can easily
perform them without requiring an independently developed SAMP library.
This has the additional advantages that central effort does not have to
be expended in producing language-specific libraries, and that
the question of "unsupported" languages does not arise.

<p></p>
Splitting the abstract interface and Profile descriptions 
in this way
separates the basic design principles from the details
of how to apply them, and it opens the door for other Profiles
serving other use cases in the future. 

<p></p>
This document defines two profiles along the lines of (1) above.
The Standard Profile (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a>)
which dates from the first version of this document,
is suitable for desktop applications,
while the Web Profile (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:webprofile">5</a>),
introduced at SAMP version 1.3,
is suitable for web (browser-based) applications.

<p></p>
A client author will usually only need to implement SAMP communications
using a single profile.
Hub implementations should ideally implement all known profiles;
in this way clients using different profiles can communicate
transparently with each other via a hub which mediates between them.
Since the different profiles are based on the same abstract interface
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:apis">3</a>),
such mediation will not lead to loss or distortion of the communications.

<p></p>
     <h3>
<a name="tth_sEc2.8">
2.8</a>&nbsp;&nbsp;Security Considerations</h3>
<a name="sect:security">
</a>

<p></p>
SAMP enables inter-process communications including the capability for
one client to cause execution of code by another client.
This raises the possibility of an unprivileged client performing
privileged actions in virtue of its SAMP-enabled interoperation.
Whether this is problematic in practice depends on two things:
first the identities of the interoperating clients
(whether they all share similar levels of privilege or trust)
and second the semantics of the messages
(the nature of the code that may be executed remotely, and particularly
how it can be parameterised).
In the case that untrusted clients can cause execution of potentially
damaging code by trusted clients, there is a serious security issue.

<p></p>
The trustedness of registered clients is determined by the profile
or profiles operated by the hub at a given time (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profiles">2.7</a>),
since the extent to which registered clients are trusted may differ
between different profiles.
Clients registering via the Standard Profile in its usual configuration
can be assumed all to be owned by the same user and hence to have
the same privileges (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:std-security">4.3.2</a>),
but Web Profile clients usually have only
limited access privileges outside of the interoperability granted by SAMP
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-security">5.4</a>).

<p></p>
In most cases profiles will, in virtue of their definition or at least
of their implementation, provide reasonable assurance that
registered clients are unlikely to be hostile.
However for clients which may be run in a general SAMP context,
it is wise not to expose via SAMP mechanisms unrestricted access
to sensitive resources.
In particular, it is recommended not to introduce MTypes which can
be made to execute arbitrary code (inviting injection attacks),
or to declare metadata which reveals sensitive information.
As an alternative approach, it may be appropriate in certain usage
scenarios to ensure that only a restricted secure profile is running.

<p></p>
 <h2>
<a name="tth_sEc3">
3</a>&nbsp;&nbsp;Abstract APIs and Data Types</h2>
<a name="sect:apis">
</a>

<p></p>
     <h3>
<a name="tth_sEc3.1">
3.1</a>&nbsp;&nbsp;Hub Discovery Mechanism</h3>
<a name="sect:hub-discovery">
</a>

<p></p>
In order to keep track of which hub is running, a hub discovery mechanism, capable 
of yielding information about how to determine the existence of and communicate with 
a running hub, is needed. This is a Profile-specific matter and
specific prescriptions are described in Sections
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:lockfile">4.3</a> (Standard Profile) and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a> (Web Profile).

<p></p>
     <h3>
<a name="tth_sEc3.2">
3.2</a>&nbsp;&nbsp;Communicating with the Hub</h3>
The details of how a client communicates with the hub are Profile-specific.
Specific prescriptions are described in Sections 
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a> (Standard Profile) and 
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:webprofile">5</a> (Web Profile).

<p></p>
     <h3>
<a name="tth_sEc3.3">
3.3</a>&nbsp;&nbsp;SAMP Data Types</h3>
<a name="sect:samp-data-types">
</a>

<p></p>
For all hub/client communication, including the actual content of messages,
SAMP uses three conceptual data types:

<ol type="1">
<li> <tt>string</tt> - a scalar value consisting of a sequence of characters;
       each character is an ASCII character with hex code
       09, 0a, 0d or 20-7f
<div class="p"></div>
</li>

<li> <tt>list</tt> - an ordered array of data items
<div class="p"></div>
</li>

<li> <tt>map</tt> - an unordered associative array of key-value pairs,
      in which each key is a <tt>string</tt> and each value is a data item
<div class="p"></div>
</li>
</ol>
These types can in principle be nested to any level, so that the elements
of a list or the values of a map may themselves be strings, lists or maps.

<p></p>
There is no reserved representation for a null value, and it is 
illegal to send a null value in a SAMP context even if the underlying
transport protocol permits this.  However a zero-length
string or an empty list or map may, where appropriate, be used to 
indicate an empty value.

<p></p>
Although SAMP imposes no maximum on the length of a string,
particular transport protocols or implementation considerations 
may effectively do so; in general, hub and client implementations 
are not expected to deal with data items of unlimited size.
General purpose MTypes SHOULD therefore be specified so that
bulk data is not sent within the message or response.  In general it is
preferred to define a message parameter or result element 
as the URL or filename of a potentially
large file rather than as the inline text of the file itself.
SAMP defines no formal list of which URL protocols are permitted
in such cases, but clients which need to dereference such URLs
SHOULD be capable of dealing with at least the "http" and "file" schemes.
"https", "ftp" and other schemes are also permitted, but when 
sending such URLs, consideration should be given to whether receiving
clients are likely to be able to dereference them.

<p></p>
At the protocol level there is no provision for typing of scalars.
Unlike many Remote Procedure Call (RPC) protocols SAMP does not distinguish syntactically
between strings, integers, floating point values, booleans etc.
This minimizes the restrictions on what underlying transport
protocols may be used, and avoids a number of problems associated with
using typed values from weakly-typed languages such as 
Python and Perl.
The practical requirement to transmit these types is addressed however
by the next section.

<p></p>
     <h3>
<a name="tth_sEc3.4">
3.4</a>&nbsp;&nbsp;Scalar Type Encoding Conventions</h3>
<a name="sect:scalar-types">
</a>

<p></p>
Although the protocol itself defines <tt>string</tt> as the only scalar type,
some MTypes will wish to define parameters or return
values which have non-string semantics,
so conventions for encoding these as <tt>string</tt>s
are in practice required. 
Such conventions only need to be understood by the sender and 
recipient of a given message and so can be established on a per-MType basis, 
but to avoid unnecessary duplication of effort
this section defines some commonly-used
type encoding conventions.

<p></p>
We define the following BNF productions:

<pre>&nbsp;&nbsp;&lt;digit&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;"0"&nbsp;|&nbsp;"1"&nbsp;|&nbsp;"2"&nbsp;|&nbsp;"3"&nbsp;|&nbsp;"4"&nbsp;|&nbsp;"5"&nbsp;|&nbsp;"6"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;"7"&nbsp;|&nbsp;"8"&nbsp;|&nbsp;"9"
&nbsp;&nbsp;&lt;digits&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&lt;digit&gt;&nbsp;|&nbsp;&lt;digits&gt;&nbsp;&lt;digit&gt;
&nbsp;&nbsp;&lt;float-digits&gt;&nbsp;::=&nbsp;&lt;digits&gt;&nbsp;|&nbsp;&lt;digits&gt;&nbsp;"."&nbsp;|&nbsp;"."&nbsp;&lt;digits&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&lt;digits&gt;&nbsp;"."&nbsp;&lt;digits&gt;
&nbsp;&nbsp;&lt;sign&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;"+"&nbsp;|&nbsp;"-"

</pre>
With reference to the above we define the following type encoding conventions:

<ul>
<li> <tt>&lt;SAMP&nbsp;int&gt;&nbsp;::=&nbsp;[&nbsp;&lt;sign&gt;&nbsp;]&nbsp;&lt;digits&gt;</tt><br>
   An integer value is encoded using its decimal representation with
   an OPTIONAL preceding sign and with no
   leading, trailing or embedded whitespace.
   There is no guarantee about the largest or smallest values which can
   be represented, since this will depend on the processing environment
   at decode time. <br><div class="p"></div>
</li>

<li> <tt>&lt;SAMP&nbsp;float&gt;&nbsp;::=&nbsp;[&nbsp;&lt;sign&gt;&nbsp;]&nbsp;&lt;float-digits&gt;</tt><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;"e"&nbsp;|&nbsp;"E"&nbsp;[&nbsp;&lt;sign&gt;&nbsp;]&nbsp;&lt;digits&gt;&nbsp;]</tt><br>
   A floating point value is encoded as a mantissa with an OPTIONAL
   preceding sign followed by an OPTIONAL exponent part
   introduced with the character "<tt>e</tt>" or "<tt>E</tt>".
   There is no guarantee about the largest or smallest values which can
   be represented or about the number of digits of precision which are
   significant, since these will depend on the processing environment
   at decode time. <br><div class="p"></div>
</li>

<li> <tt>&lt;SAMP&nbsp;boolean&gt;&nbsp;::=&nbsp;"0"&nbsp;|&nbsp;"1"</tt><br>
   A boolean value is represented as an integer: zero represents false,
   and any other value represents true.
   1 is the RECOMMENDED value to represent true.
<div class="p"></div>
</li>
</ul>
<p></p>
The numeric types are based on the syntax of the C programming language,
since this syntax forms the basis for typed data syntax in many other
languages.
There may be extensions to this list in future versions of this standard.

<p></p>
Particular MType definitions may use these conventions or devise
their own as required.  Where the conventions in this list are used, 
message documentation SHOULD make it clear using a form of
words along the lines "this parameter contains a <em>SAMP int </em>".

<p></p>
     <h3>
<a name="tth_sEc3.5">
3.5</a>&nbsp;&nbsp;Registering with the Hub</h3>
<a name="sect:registration">
</a>

<p></p>
A client registers with the hub to:

<ol type="1">
<li> establish communication with the hub
<div class="p"></div>
</li>

<li> advertise its presence to the hub and to other clients
<div class="p"></div>
</li>

<li> obtain registration information
<div class="p"></div>
</li>
</ol>
The registration information is in the form of a <tt>map</tt> containing
data items which the client may wish to use during the SAMP session.
The hub MUST fill in values for the following keys in the returned <tt>map</tt>:

<dl compact="">
<dt><b><tt>samp.hub-id</tt></b></dt>
	<dd> -
   The client ID which is used by the hub when it sends messages itself 
   (rather than forwarding them from other senders).
   For instance, this ID will be used when the hub sends the 
   <tt>samp.hub.event.shutdown</tt> message.</dd>
 <dt><b><tt>samp.self-id</tt></b></dt>
	<dd> -
   The client ID which identifies the registering client.</dd>
</dl>
These keys form part of an extensible vocabulary as explained in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.
In most cases a client will not require either of the above IDs for
normal SAMP operation, but they are there for clients which do wish
to know them.
Particular Profiles may require additional entries in this map.

<p></p>
Immediately following registration, the client will typically
perform some or all of the following OPTIONAL operations:

<ul>
<li> supply the hub with metadata about itself, using the
    <tt>declareMetadata()</tt> call
<div class="p"></div>
</li>

<li> tell the hub how it wishes the hub to communicate with it,
    if at all (the mechanism for this is profile-dependent, and it may
    be implicit in registration)
<div class="p"></div>
</li>

<li> inform the hub which MTypes it wishes to subscribe to, using the
    <tt>declareSubscriptions()</tt> call
<div class="p"></div>
</li>
</ul>
<p></p>
     <h3>
<a name="tth_sEc3.6">
3.6</a>&nbsp;&nbsp;Application Metadata</h3>
<a name="sect:app-metadata">
</a>

<p></p>
A client may store metadata in the form of a <tt>map</tt> of key-value pairs in the hub 
for retrieval by other clients. Typical metadata might be the human-readable 
name of the application, a description and a URL for its icon, but other values 
are permitted. The following keys are defined for well-known metadata items:

<dl compact="">
<dt><b><tt>samp.name</tt></b></dt>
	<dd> - A one word title for the application.</dd>
 <dt><b><tt>samp.description.text</tt></b></dt>
	<dd> - A short description of the 
application, in plain text.</dd>
 <dt><b><tt>samp.description.html</tt></b></dt>
	<dd> - A description of the application, 
in HTML.</dd>
 <dt><b><tt>samp.icon.url</tt></b></dt>
	<dd> - The URL of an icon in png, gif or jpeg format.</dd>
 <dt><b><tt>samp.documentation.url</tt></b></dt>
	<dd> - The URL of a documentation web page.</dd>
</dl>
All of the above are OPTIONAL, but <tt>samp.name</tt> is strongly RECOMMENDED.
These keys form the basis of an extensible vocabulary as explained in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.

<p></p>
     <h3>
<a name="tth_sEc3.7">
3.7</a>&nbsp;&nbsp;MType Subscriptions</h3>
<a name="sect:subscription">
</a>

<p></p>
As outlined above, an MType is a string which defines the semantics of 
a message.  MTypes have a hierarchical form.  Their syntax is given
by the following BNF:

<pre>&nbsp;&nbsp;&lt;mchar&gt;&nbsp;&nbsp;::=&nbsp;[0-9A-Za-z]&nbsp;|&nbsp;"-"&nbsp;|&nbsp;"_"
&nbsp;&nbsp;&lt;atom&gt;&nbsp;&nbsp;&nbsp;::=&nbsp;&lt;mchar&gt;&nbsp;|&nbsp;&lt;atom&gt;&nbsp;&lt;mchar&gt;
&nbsp;&nbsp;&lt;mtype&gt;&nbsp;&nbsp;::=&nbsp;&lt;atom&gt;&nbsp;|&nbsp;&lt;mtype&gt;&nbsp;"."&nbsp;&lt;atom&gt;

</pre>
Examples might be "<tt>samp.hub.event.shutdown</tt>" or "<tt>file.load</tt>".

<p></p>
A client may <em>subscribe </em> to one or more MTypes to indicate 
which messages it is willing to receive.  A client will only ever
receive messages with MTypes to which it has subscribed.
In order to do this it passes a subscriptions <tt>map</tt> to the hub.
Each key of this map is an MType string to which the client wishes
to subscribe, and the corresponding value is a map which may contain
additional information about that subscription.  Currently, no keys
are defined for these per-MType maps, so typically they will be empty
(have no entries).  The use of a map here is to permit experimentation
and perhaps future extension of the SAMP standard.

<p></p>
As a special case, simple wildcarding is permitted in subscriptions.
The keys of the subscription map may actually be of the form
<tt>&lt;msub&gt;</tt>, where

<pre>&nbsp;&nbsp;&lt;msub&gt;&nbsp;&nbsp;&nbsp;::=&nbsp;"*"&nbsp;|&nbsp;&lt;mtype&gt;&nbsp;"."&nbsp;"*"

</pre>
Thus a subscription key "<tt>file.event.*</tt>" means that a client wishes
to receive any messages with MType which begin "<tt>file.event.</tt>".
This does not include "<tt>file.event</tt>".
A subscription key "<tt>*</tt>" subscribes to all MTypes.
Note that the wildcard "<tt>*</tt>" character may only appear
at the end of a subscription key, and that this indicates 
subscription to the entire subtree.

<p></p>
More discussion of MTypes, including their semantics, is given in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mtypes">6</a>.

<p></p>
     <h3>
<a name="tth_sEc3.8">
3.8</a>&nbsp;&nbsp;Message Encoding</h3>
<a name="sect:msg-encode">
</a>

<p></p>
A message is an abstract container for the information we wish to send
to another application.  The message itself is that data which should
arrive at the receiving application.  It may be transmitted along
with some external items (e.g.&nbsp;sender, recipient and message identifiers)
required to ensure proper delivery or handling.

<p></p>
A message is encoded for SAMP transmission as a <tt>map</tt> with the following REQUIRED keys:

<dl compact="">
<dt><b><tt>samp.mtype</tt></b></dt>
	<dd> -
  A <tt>string</tt> giving the MType which defines the meaning of the message.
  The MType also, via external documentation, defines the names, types and 
  meanings of any parameters and return values.
  MTypes are discussed in more detail in 
  Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mtypes">6</a>.</dd>
 <dt><b><tt>samp.params</tt></b></dt>
	<dd> -
  A <tt>map</tt> containing the values for the message's named parameters.
  These give the data required for the receiver to act on the message,
  for instance the URL of a given file.  The names, types and semantics 
  of these parameters are determined by the MType.
  Each key in this map is the name of a parameter, and the corresponding
  value is that parameter's value.</dd>
</dl>
These keys form the basis of an extensible vocabulary as explained in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.

<p></p>
     <h3>
<a name="tth_sEc3.9">
3.9</a>&nbsp;&nbsp;Response Encoding</h3>
<a name="sect:response-encode">
</a>

<p></p>
A response is what may be returned from a recipient to a sender giving
the result of processing a message (though in the case of the Notification
delivery pattern, no such response is generated or returned).
It may contain MType-specific return values, or error information, or both.

<p></p>
A response is encoded for SAMP transmission as a <tt>map</tt> with the following keys:

<dl compact="">
<dt><b><tt>samp.status</tt></b></dt>
	<dd> (REQUIRED) -
   A <tt>string</tt> summarising the result of the processing.
   It may take one of the following defined values:
   
<dl compact="">
<dt><b><tt>samp.ok</tt>:</b></dt>
	<dd>
      Processing successful.
      The <tt>samp.result</tt>, but not the <tt>samp.error</tt> entry
      SHOULD be present.</dd>
 <dt><b><tt>samp.warning</tt>:</b></dt>
	<dd>
      Processing partially successful.
      Both <tt>samp.result</tt> and <tt>samp.error</tt> entries SHOULD be present.</dd>
 <dt><b><tt>samp.error</tt>:</b></dt>
	<dd>
      Processing failed.
      The <tt>samp.error</tt>, but not the <tt>samp.result</tt> entry
      SHOULD be present.</dd>
</dl>
   These values form the basis of an extensible vocabulary as explained in
   Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.</dd>
 <dt><b><tt>samp.result</tt></b></dt>
	<dd> (REQUIRED in case of full or partial success) -
   A <tt>map</tt> containing the values for the message's named return values.
   The names, types and semantics of these returns are determined by
   the MType.
   Each key in this map is the name of a return value, and the corresponding
   value is the actual value.
   Note that even for MTypes which define no return values, the value of this
   entry MUST still be a <tt>map</tt> (typically an empty one).</dd>
 <dt><b><tt>samp.error</tt></b></dt>
	<dd> (REQUIRED in case of full or partial error) -
   A <tt>map</tt> containing error information.
   The following keys are defined for this map:
   
<dl compact="">
<dt><b><tt>samp.errortxt</tt></b></dt>
	<dd> (REQUIRED) -
         A short string describing what went wrong.
         This will typically be delivered to the user of the sender application.</dd>
 <dt><b><tt>samp.usertxt</tt></b></dt>
	<dd> (OPTIONAL) -
         A free-form string containing any additional text an application wishes
         to return.  This may be a more verbose error description meant to be  
         appended to the <tt>samp.errortxt</tt> string,
         however it is undefined how this 
         string should be handled when received.</dd>
 <dt><b><tt>samp.debugtxt</tt></b></dt>
	<dd> (OPTIONAL) -
         A longer string which may contain more detail on what went wrong.
         This is typically intended for debugging purposes, and may for instance
         be a stack trace.</dd>
 <dt><b><tt>samp.code</tt></b></dt>
	<dd> (OPTIONAL) -
         A string containing a numeric or textual code identifying the error,
         perhaps intended to be parsable by software.
         Values beginning "<tt>samp.</tt>" are reserved.</dd>
</dl>
   These keys form the basis of an extensible vocabulary as explained in
   Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.</dd>
</dl>
These keys form the basis of an extensible vocabulary as explained in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.

<p></p>
In most cases, such responses will be generated by a Recipient client 
and forwarded by the Hub to the Sender.
In some cases however the hub may pass to the sender an error response it has
generated itself on behalf of the recipient.
In particular, if the hub determines that no response will ever be received
from the recipient (perhaps because the recipient has unregistered
without replying) the hub MAY generate and forward a response with
<tt>samp.status=samp.error</tt> and the <tt>samp.code</tt> key in the 
<tt>samp.error</tt> structure set to "<tt>samp.noresponse</tt>".
Clients SHOULD NOT generate such <tt>samp.code=samp.noresponse</tt> responses
themselves.

<p></p>
     <h3>
<a name="tth_sEc3.10">
3.10</a>&nbsp;&nbsp;Sending and Receiving Messages</h3>
<a name="sect:delivery">
</a>

<p></p>
As outlined in Section&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:delivery-outline">2.5</a>, 
three messaging patterns are supported, differing
according to whether and how the response is returned to the sender. 
For a given MType 
there may be a messaging pattern that is most typically used, but there is 
nothing in the protocol that ties a particular MType to a particular messaging 
pattern; any MType may legally be sent using any delivery pattern.

<p></p>
From the point of view of the sender, there are three ways in which a message
may be sent,
and from the point of view of the recipient there are two ways in which
one may be received.  These are described as follows.

<dl compact="">
<dt><b>Notification:</b></dt>
	<dd>  In the notification pattern, communication is only
in one direction:

<ol type="1">
<li> The sender sends a message to the hub for delivery to one or more
   recipients.
<div class="p"></div>
</li>

<li> The hub forwards the message to those requested recipients which are subscribed.
<div class="p"></div>
</li>

<li> No reply from the recipients is expected or possible.
<div class="p"></div>
</li>
</ol>
Notifications can be sent to a given recipient or broadcast to all 
recipients.  The notification pattern for a single recipient is illustrated in 
Figure&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#fig:notification">3</a>.


<a name="tth_fIg3">
</a> 
<center>
<img src="./sample_files/samp-notification.gif" alt="samp-notification.gif"><center>Figure 3: Notification pattern</center>
<a name="fig:notification">
</a>
</center>


</dd>
 <dt><b>Asynchronous Call/Response:</b></dt>
	<dd>
In the asynchronous call pattern, <em>message tags </em> and
<em>message identifiers </em> are used 
to tie together messages and their replies:

<ol type="1">
<li> The sender sends a message to the hub for delivery to one or more
    recipients, supplying along with the message a tag string of its
    own choice, <em>msg-tag </em>.  In return it receives a unique 
    identifier string, <em>msg-id </em>.
<div class="p"></div>
</li>

<li> The hub forwards the message to the appropriate recipients,
    supplying along with the message an identifier string, <em>msg-id </em>.
<div class="p"></div>
</li>

<li> Each recipient processes the message, and sends its response
    back to the hub along with the ID string <em>msg-id </em>.
<div class="p"></div>
</li>

<li> Using a callback, the hub passes the response back to the 
    original sender along with the ID string <em>msg-tag </em>.
<div class="p"></div>
</li>
</ol>
The sender is free to use any value for the <em>msg-tag </em>.
There is no requirement on the form of the hub-generated <em>msg-id </em>
(it is not intended to be parsed by the recipient), but it MUST be
sufficient for the hub to pair messages with their responses reliably,
and to pass the correct <em>msg-tag </em> back with the response 
to the sender<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFtNtAAB" name="tthFrefAAB"><sup>1</sup></a>.
In most cases the sender will not require the <em>msg-id </em>, since
the <em>msg-tag </em> is sufficient to match calls with responses.
For this reason, the sender need not retain the <em>msg-id </em> and
indeed need not wait for it, avoiding a hub round trip at send time.
The only case in which the sender may require the <em>msg-id </em> is
if it needs to communicate later with the recipient about the message
that was sent, for instance as part of a progress report.
Asynchronous calls may be sent to a given recipient or broadcast to all
recipients.  In the latter case, the sender SHOULD be prepared to deal
with multiple responses to the same call.
The asynchronous pattern is illustrated in Figure&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#fig:async">4</a>.


<a name="tth_fIg4">
</a> 
<center>
<img src="./sample_files/samp-asynchronous.gif" alt="samp-asynchronous.gif"><center>Figure 4: Asynchronous Call/Response pattern</center>
<a name="fig:async">
</a>
</center>


</dd>
 <dt><b>Synchronous Call/Response</b></dt>
	<dd>
A synchronous utility method is provided by the hub, mainly for
the convenience of
environments where dealing with asynchronicity might be a problem.
The hub will provide synchronous behaviour to the sender,
interacting with the receiver in exactly the same way as for the
asynchronous case above.

<ol type="1">
<li> The sender sends a message to the hub for delivery to a given recipient,
      optionally specifying as well a maximum time it is prepared to wait.
      The sender's call blocks until a response is available.
<div class="p"></div>
</li>

<li> The hub forwards the message to the recipient,
    supplying along with the message an ID string, <em>msg-id </em>.
<div class="p"></div>
</li>

<li> The recipient processes the message, and sends its response
    back to the hub along with the ID string <em>msg-id </em>.
<div class="p"></div>
</li>

<li> The hub passes back the response as the return value from the original
    blocking call made by the sender.  If no response is received within
    the sender's specified timeout the blocking call will terminate with 
    an error.  The hub is not guaranteed to wait indefinitely; 
    it MAY in effect impose its own timeout.
<div class="p"></div>
</li>
</ol>
There is no broadcast counterpart for the synchronous call.
This pattern is illustrated in Figure&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#fig:sync">5</a>.


<a name="tth_fIg5">
</a> 
<center>
<img src="./sample_files/samp-synchronous.gif" alt="samp-synchronous.gif"><center>Figure 5: Synchronous Call/Response pattern</center>
<a name="fig:sync">
</a>
</center>


</dd>
</dl>
<p></p>
Note that the two different cases from the receiver's point of view,
<em>Notification </em> and <em>Call/Response </em>, 
differ only in whether a response is returned to the hub.
In other respects the receiver SHOULD process the message in 
exactly the same way for both patterns.

<p></p>
Although it is REQUIRED by this standard that client applications
provide a Response for every Call that they receive, there is no
way that the hub can enforce this.  Senders using the Synchronous
or Asynchronous Call/Response patterns therefore should be aware 
that badly-behaved recipients might fail to respond, leading to calls
going unanswered indefinitely.  The timeout parameter in the
Synchronous Call/Response pattern provides some protection from
this eventuality; users of the Asynchronous Call/Response pattern
may or may not wish to take their own steps.

<p></p>
     <h3>
<a name="tth_sEc3.11">
3.11</a>&nbsp;&nbsp;Operations a Hub Must Support</h3>
<a name="sect:hubOps">
</a>
This section describes the operations that a hub MUST support and the associated
data that MUST be sent and received.
The precise details of how these operations 
map onto method names and signatures is Profile-dependent.
The mapping for the 
Standard Profile is described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mappingXMLRPC">4.2</a>,
and for the Web Profile in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:webXMLRPC">5.2.2</a>.

<ul>
<li> <tt>map&nbsp;reg-info&nbsp;=&nbsp;register()</tt><br>
    Method called by a client wishing to register 
    with the hub.
    The form of <tt>reg-info</tt> is given in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:registration">3.5</a>.
    Note that the form of this call may vary according to the requirements 
    of the particular Profile in use. For instance authentication tokens
    may be passed in one or both directions to complete registration.
    <br><div class="p"></div>
</li>

<li> <tt>unregister()</tt><br>
    Method called by a client wishing to unregister from the hub.
    <br><div class="p"></div>
</li>

<li> <tt>declareMetadata(map&nbsp;metadata)</tt><br>
    Method called 
    by a client to declare its metadata.
    May be called zero or more times to update hub state; the most recent 
    call is the one which defines the client's currently declared metadata.
    The form of the <tt>metadata</tt> map is given in
    Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:app-metadata">3.6</a>.
    <br><div class="p"></div>
</li>

<li> <tt>map&nbsp;metadata&nbsp;=&nbsp;getMetadata(string&nbsp;client-id)</tt><br>
    Returns the metadata
    information for the client whose public ID is <tt>client-id</tt>.
    The form of the <tt>metadata</tt> map is given in 
    Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:app-metadata">3.6</a>.
    <br><div class="p"></div>
</li>

<li> <tt>declareSubscriptions(map&nbsp;subscriptions)</tt><br>
    Method called by
    a callable client to declare the MTypes it wishes to subscribe to.
    May be called zero or more times to update hub state; the most recent 
    call is the one which defines the client's currently subscribed MTypes.
    The form of the <tt>subscriptions</tt> map is given in
    Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a>.
    <br><div class="p"></div>
</li>

<li> <tt>map&nbsp;subscriptions&nbsp;=&nbsp;getSubscriptions(string&nbsp;client-id)</tt><br>
    Returns the subscribed MTypes
    for the client whose public ID is <tt>client-id</tt>.
    The form of the <tt>subscriptions</tt> map is given in
    Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a>.
    <br><div class="p"></div>
</li>

<li> <tt>list&nbsp;client-ids&nbsp;=&nbsp;getRegisteredClients()</tt><br>
    Returns the list of public ids of all other registered clients.
    The caller's ID (<tt>samp.self-id</tt> from Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:registration">3.5</a>) 
    is not included,
    but the hub's ID (<tt>samp.hub-id</tt> from Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:registration">3.5</a>) is.
    <br><div class="p"></div>
</li>

<li> <tt>map&nbsp;client-subs&nbsp;=&nbsp;getSubscribedClients(string&nbsp;mtype)</tt><br>
    Returns a map with an entry for all other registered clients which are
    subscribed to the MType <tt>mtype</tt>.
    The key for each entry is a subscribed client ID, 
    and the value is a (possibly empty) <tt>map</tt> 
    providing further information on its subscription to <tt>mtype</tt> 
    as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a>.
    An entry for the caller is not included, even if it is subscribed.
    <tt>mtype</tt> MUST NOT include wildcards.
    <br><div class="p"></div>
</li>

<li> <tt>notify(string&nbsp;recipient-id,&nbsp;map&nbsp;message)</tt><br>
    Sends a message using the Notification pattern
    to a given recipient.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    An error results if the recipient is not subscribed to the message's
    MType.
    <br><div class="p"></div>
</li>

<li> <tt>list&nbsp;recipient-ids&nbsp;=&nbsp;notifyAll(map&nbsp;message)</tt><br>
    Sends a message using the Notification pattern
    to all other clients which are subscribed to the message's MType.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    The return value is a <tt>list</tt> of the client IDs of the clients
    to which an attempt to send the message is made.
    <br><div class="p"></div>
</li>

<li> <tt>string&nbsp;msg-id&nbsp;=&nbsp;call(string&nbsp;recipient-id,&nbsp;string&nbsp;msg-tag,</tt><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;message)</tt><br>
    Sends a message using the Asynchronous Call/Response pattern
    to a given recipient.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    An error results if the recipient is not subscribed to the message's
    MType, or if the invoking client is not Callable.
    <br><div class="p"></div>
</li>

<li> <tt>map&nbsp;calls&nbsp;=&nbsp;callAll(string&nbsp;msg-tag,&nbsp;map&nbsp;message)</tt><br>
    Sends a message using the Asynchronous Call/Response pattern
    to all other clients which are subscribed to the message's MType.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    The returned value is a <tt>map</tt> in which the keys are the client IDs
    of clients to which an attempt to send the message is made,
    and the values are the associated <tt>msg-id</tt> strings.
    An error results if the invoking client is not Callable.
    <br><div class="p"></div>
</li>

<li> <tt>map&nbsp;response&nbsp;=&nbsp;callAndWait(string&nbsp;recipient-id,</tt><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;message,&nbsp;string&nbsp;timeout)</tt><br>
    Sends a message using the Synchronous Call/Response pattern
    to a given recipient.
    The forms of the <tt>message</tt> and <tt>response</tt> maps are given 
    in Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.
    The <tt>timeout</tt> parameter is interpreted as a <em>SAMP int </em>
    (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:scalar-types">3.4</a>) giving
    the maximum number of seconds the client wishes to wait.
    If the response takes longer than that to arrive this method SHOULD
    terminate anyway with an error (it MUST not return a <tt>response</tt> indicating
    error).
    Any response arriving from the recipient after that will be discarded.
    If <tt>timeout</tt> &lt; =0 then no artificial timeout is imposed.
    An error results if the recipient is not subscribed to the message's
    MType.
    <br><div class="p"></div>
</li>

<li> <tt>reply(string&nbsp;msg-id,&nbsp;map&nbsp;response)</tt><br>
    Method
    called by a client to send its response to a given message.
    The form of the <tt>response</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.
<div class="p"></div>
</li>
</ul>
<p></p>
Of these operations, only <tt>callAndWait()</tt> involves blocking communication
with another client.
The others SHOULD be implemented in such a way that clients can expect
them to complete, and where appropriate return a value, on a timescale
short compared to user response time.

<p></p>
     <h3>
<a name="tth_sEc3.12">
3.12</a>&nbsp;&nbsp;Operations a Callable Client Must Support</h3>
<a name="sect:clientOps">
</a>

<p></p>
This section lists the operations which a client MUST support in order
to be classified as callable.
The hub uses these operations when it wishes to 
pass information to a callable client.
Note that callability is OPTIONAL for clients; special (Profile-dependent) steps
may be required for a client to inform the hub how it can be contacted,
and thus become callable.  Clients which are not callable can send
messages using the Notify or Synchronous Call/Response patterns,
but are unable to receive messages or to use Asynchronous Call/Response,
since these operations rely on client callbacks from the hub.

<p></p>
The precise details of how these operations 
map onto method names and signatures is Profile-dependent.
The mapping for 
the Standard Profile is given in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mappingXMLRPC">4.2</a>
and for the Web Profile in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-callable">5.2.5</a>.

<ul>
<li> <tt>receiveNotification(string&nbsp;sender-id,&nbsp;map&nbsp;message)</tt><br>
    Method called by the hub when dispatching a notification to its
    recipient.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    <br><div class="p"></div>
</li>

<li> <tt>receiveCall(string&nbsp;sender-id,&nbsp;string&nbsp;msg-id,&nbsp;map&nbsp;message)</tt><br>
    Method called by the hub when dispatching a call to its recipient. The client
    MUST at some later time make a matching call to <tt>reply()</tt> on the hub.
    The form of the <tt>message</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:msg-encode">3.8</a>.
    <br><div class="p"></div>
</li>

<li> <tt>receiveResponse(string&nbsp;responder-id,&nbsp;string&nbsp;msg-tag,</tt><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;response)</tt><br>
    Method used by the hub to dispatch to the sender the response of an
    earlier asynchronous call.
    The form of the <tt>response</tt> map is given 
    in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.
<div class="p"></div>
</li>
</ul>
<p></p>
     <h3>
<a name="tth_sEc3.13">
3.13</a>&nbsp;&nbsp;Error Processing</h3>
<a name="sect:faults">
</a>

<p></p>
Errors encountered by clients when processing Call/Response-pattern messages 
themselves (in response to a syntactically legal <tt>receiveCall()</tt>
operation) SHOULD be signalled by returning appropriate content in
the response map sent back in the matching <tt>reply()</tt> call,
as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.

<p></p>
In the case of failed calls of
the operations defined in Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>,
for instance syntactically invalid parameters or communications failures,
hubs and clients SHOULD where possible use the usual error reporting 
mechanisms of the transport protocol in use.

<p></p>
Where it is problematic or impossible to use the transport protocol's
error reporting mechanisms, in the case of a Call/Response pattern message,
the hub MAY signal errors by generating and passing back 
to the sender a suitable response map as described in Section 
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.

<p></p>

 <h2>
<a name="tth_sEc4">
4</a>&nbsp;&nbsp;Standard Profile</h2>
<a name="sect:profile">
</a>

<p></p>
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:apis">3</a> provides an abstract definition of 
the operations and data structures used for SAMP messaging.
As explained in Section&nbsp;<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profiles">2.7</a>, 
in order to implement this architecture some concrete choices about 
how to instantiate these concepts are required.

<p></p>
This section gives the details of a SAMP Profile based on the 
XML-RPC specification [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xmlrpc">7</a>].  
Hub discovery is via a lockfile in the user's home directory.

<p></p>
XML-RPC is a simple general purpose Remote Procedure Call
protocol based on sending XML documents using HTTP POST
(it resembles a very lightweight version of SOAP).
Since the mappings from SAMP concepts
such as API calls and data types to their XML-RPC equivalents is very 
straightforward, it is easy for application authors to write 
compliant code without use of any SAMP-specific library code.
An XML-RPC library, while not essential, will make coding much easier;
such libraries are available for many languages.

<p></p>
     <h3>
<a name="tth_sEc4.1">
4.1</a>&nbsp;&nbsp;Data Type Mappings</h3>
<a name="sect:profile-typemap">
</a>

<p></p>
The SAMP argument and return value data types described in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:samp-data-types">3.3</a> map straightforwardly onto XML-RPC
data types as follows:

<center>

<table>
<tbody><tr>
<td>SAMP type    </td>
<td align="center"></td>
<td>XML-RPC element </td>
</tr>
<tr>
<td>
<tt>string</tt> </td>
<td align="center">- </td>
<td>
<tt>&lt;string&gt;</tt> </td>
</tr>
<tr>
<td>
<tt>list</tt>   </td>
<td align="center">- </td>
<td>
<tt>&lt;array&gt;</tt> </td>
</tr>
<tr>
<td>
<tt>map</tt>    </td>
<td align="center">- </td>
<td>
<tt>&lt;struct&gt;</tt> </td>
</tr>
</tbody></table>
</center>
The <tt>&lt;value&gt;</tt> children of <tt>&lt;array&gt;</tt> and <tt>&lt;struct&gt;</tt> elements
themselves contain children of type <tt>&lt;string&gt;</tt>, <tt>&lt;array&gt;</tt> or
<tt>&lt;struct&gt;</tt>.

<p></p>
Note that other XML-RPC scalar types (<tt>&lt;i4&gt;</tt>, <tt>&lt;double&gt;</tt> etc)
are not used; even where the semantic sense of a value matches
one of those types it MUST be encoded as an XML-RPC <tt>&lt;string&gt;</tt>.

<p></p>
     <h3>
<a name="tth_sEc4.2">
4.2</a>&nbsp;&nbsp;API Mappings</h3>
<a name="sect:mappingXMLRPC">
</a>

<p></p>
The operation names in the SAMP hub and client abstract APIs
(Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>) very nearly 
have a one to one mapping with those in the Standard Profile XML-RPC APIs.
The Standard Profile API MUST be implemented as described in Sections
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a> with the following REQUIRED adjustments:

<ol type="1">
<li> The XML-RPC method names (i.e.&nbsp;the contents of the XML-RPC
      <tt>&lt;methodName&gt;</tt> elements) are formed by 
      prefixing the hub and client abstract API operation names with
      "<tt>samp.hub.</tt>" or "<tt>samp.client.</tt>" respectively.
<div class="p"></div>
</li>

<li> The <tt>register()</tt> operation takes the following form:
      
<ul>
<li> <tt>map&nbsp;reg-info&nbsp;=&nbsp;register(string&nbsp;samp-secret)</tt>
<div class="p"></div>
</li>
</ul>
      The argument is the <tt>samp-secret</tt> value read from the lockfile
      (see Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:lockfile">4.3</a>).
      The returned <tt>reg-info</tt> map contains an additional entry 
      with key <tt>samp.private-key</tt> whose value is a string
      generated by the hub.
<div class="p"></div>
</li>

<li> <em>All </em> other hub and client methods take the 
      <tt>private-key</tt> as their first argument.
<div class="p"></div>
</li>

<li> A new method, <tt>setXmlrpcCallback()</tt> is added to the hub API.
      
<ul>
<li> <tt>setXmlrpcCallback(string&nbsp;private-key,&nbsp;string&nbsp;url)</tt>
<div class="p"></div>
</li>
</ul>
      This informs the hub of the XML-RPC endpoint on which the client 
      is listening for calls from the hub.
      The client is not considered Callable unless and until 
      it has invoked this method.
<div class="p"></div>
</li>

<li> Another new method, <tt>ping()</tt> is added to the hub API.
      This may be called by registered or unregistered applications
      (as a special case the <tt>private-key</tt> argument may be omitted),
      and can be used to determine whether the hub is responding to requests.
      Any non-error return indicates that the hub is running.
<div class="p"></div>
</li>
</ol>
<p></p>
The <tt>private-key</tt> string referred to above serves two purposes.
First it identifies the client in hub/client communications.
Some such identifier is required, since XML-RPC calls have no other way of
determining the sender's identity.
Second, it prevents application spoofing, since the private key is
never revealed to other applications, so that one application cannot
pose as another in making calls to the hub.

<p></p>
The usual XML-RPC fault mechanism is used to respond to invalid
calls as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:faults">3.13</a>.
The XML-RPC <tt>&lt;fault&gt;</tt>'s <tt>&lt;faultString&gt;</tt> element SHOULD contain a
user-directed message as appropriate and the <tt>&lt;faultCode&gt;</tt> value
has no particular significance.

<p></p>
     <h3>
<a name="tth_sEc4.3">
4.3</a>&nbsp;&nbsp;Lockfile and Hub Discovery</h3>
<a name="sect:lockfile">
</a>

<p></p>
Hub discovery is performed by examining a lockfile to determine
hub connection parameters, specifically the XML-RPC endpoint at
which the hub can be found, and a "secret" token which affords
some measure of security, given suitable restrictions on the
lockfile's readability (see Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:std-security">4.3.2</a>).
To discover the hub, a client must
therefore:

<ol type="1">
<li> Determine where to find the lockfile
        (<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:lockfileLoc">4.3.1</a>)
<div class="p"></div>
</li>

<li> Read the lockfile to obtain the hub connection parameters
        (<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:lockfileText">4.3.3</a>)
<div class="p"></div>
</li>
</ol>
<p></p>
      <h4>
<a name="tth_sEc4.3.1">
4.3.1</a>&nbsp;&nbsp;Lockfile Location</h4>
<a name="sect:lockfileLoc">
</a>

<p></p>
The default location of the lockfile is the file named "<tt>.samp</tt>"
in the user's home directory.  However the content of the environment
variable named SAMP_HUB can be used to override this default.

<p></p>
The value of the SAMP_HUB environment variable is of the form
<tt>&lt;samphub-value&gt;</tt>, as defined by the following BNF production:

<pre>&nbsp;&nbsp;&nbsp;&lt;samphub-value&gt;&nbsp;&nbsp;::=&nbsp;&nbsp;&lt;hub-location&gt;
&nbsp;&nbsp;&nbsp;&lt;hub-location&gt;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&lt;stdlock-prefix&gt;&nbsp;&lt;stdlock-url&gt;
&nbsp;&nbsp;&nbsp;&lt;lockurl-prefix&gt;&nbsp;::=&nbsp;&nbsp;"std-lockurl:"
&nbsp;&nbsp;&nbsp;&lt;stdlock-url&gt;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;(any&nbsp;URL)

</pre>
The <tt>&lt;stdlock-url&gt;</tt> will typically, but not necessarily, be a
file-type URL (as described in RFC 1738, section 3.10 [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc1738">9</a>]).
So for instance to indicate that the
lockfile to be used will be the file "<tt>/tmp/samp1</tt>", you would set

<pre>&nbsp;&nbsp;&nbsp;SAMP_HUB=std-lockurl:file:///tmp/samp1

</pre>

<p></p>
Although no other form of the <tt>&lt;hub-location&gt;</tt> value is defined
here, the intention is that the SAMP_HUB environment variable MAY
be used with prefixes other than "<tt>std-lockurl:</tt>" to indicate
use of other, non-Standard, profiles.
Issues may in future arise related to the need to indicate multiple
profiles or profile variants at once; the impact of this requirement
on the syntax and semantics of the SAMP_HUB variable is for now
deferred.

<p></p>
To locate the lockfile therefore, a Standard Profile-compliant client MUST
determine whether an environment variable named SAMP_HUB exists;
if so, the client MUST examine the variable's value;
if the value begins with the prefix "<tt>std-lockurl:</tt>"
the client MUST interpret the remainder of the value as a URL
whose content is the text of the lockfile to be used for hub discovery.
If no SAMP_HUB environment variable exists, the client MUST
use the file ".samp" in the user's home directory as the
lockfile to be used for hub discovery.
If the variable exists, but its value begins with a different prefix,
the client MAY interpret that in some non-Standard way for hub discovery.

<p></p>
Rules for a Standard Profile-compliant hub to use when writing lockfiles 
are similar, but if a hub is unable or unwilling to write a lockfile 
such that it can be read using the above procedure, it MUST signal
an error at the startup and then abort.  For practical reasons, a hub
will probably only be able to write a lockfile indicated by a <tt>file</tt>-type
URL, not for instance an arbitrary <tt>http</tt>-type one.
Lockfiles SHOULD be created with appropriate access restrictions
as discussed in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:std-security">4.3.2</a>.

<p></p>
The existence or readability of the lockfile MAY be taken 
(e.g.&nbsp;by a hub deciding whether to start or not) 
to indicate that a hub is running.
However it is RECOMMENDED to attempt to contact the hub
at the given XML-RPC URL (e.g.&nbsp;by calling <tt>ping()</tt>)
to determine whether it is actually alive.

<p></p>
The "home directory" referred to above is a somewhat system-dependent 
concept: we define it as the value of the <tt>HOME</tt> environment variable on
Unix-like systems and as the value of the <tt>USERPROFILE</tt> environment
variable on Microsoft Windows<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFtNtAAC" name="tthFrefAAC"><sup>2</sup></a>.  
"Environment variable" is itself potentially a system-dependent concept,
but it is clear how to interpret it for all platforms on which we 
currently expect SAMP to be used, so no further explanation is provided
here.

<p></p>
In version 1.11 of the standard, the lockfile was always in the
"<tt>.samp</tt>" file in the user's home directory.
The option of setting the SAMP_HUB environment variable to override
this has been introduced to allow more flexibility;
for instance one user can run multiple unconnected hubs,
or multiple users can share the same hub.
If no SAMP_HUB environment variable is defined, client and hub 
behaviour is exactly as in version 1.11.

<p></p>
      <h4>
<a name="tth_sEc4.3.2">
4.3.2</a>&nbsp;&nbsp;Security Considerations</h4>
<a name="sect:std-security">
</a>

<p></p>
The hub SHOULD normally create the lockfile with file permissions which allow
only its owner to read it.  This provides a measure of security in
that only processes with the same privileges as the hub process
(hence presumably running under the same user ID) will be able to
register with the hub, since only they will be able to provide the
secret token, obtained from the lockfile, which is required for registration.
Thus under normal circumstances all Standard Profile clients can be
presumed to be running with the same level of trust, so that
no security issues of the type discussed in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:security">2.8</a>
arise.

<p></p>
If the lockfile is made available in some way other than an
owner-only readable file, for instance via
an unprotected <tt>http</tt>-type URL in order to facilitate use of
the same hub by multiple users on different hosts, there is a potential
security risk.  In that case, protection through an authentication and/or
authorization mechanism might be adopted by the hub implementations, for
instance exploiting the TLS cryptographic protocol [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2246">10</a>].

<p></p>
      <h4>
<a name="tth_sEc4.3.3">
4.3.3</a>&nbsp;&nbsp;Lockfile Content</h4>
<a name="sect:lockfileText">
</a>

<p></p>
The format of the lockfile is given by the following BNF productions:

<pre>&nbsp;&nbsp;&nbsp;&lt;file&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;lines&gt;
&nbsp;&nbsp;&nbsp;&lt;lines&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;line&gt;&nbsp;|&nbsp;&lt;lines&gt;&nbsp;&lt;line&gt;
&nbsp;&nbsp;&nbsp;&lt;line&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;line-content&gt;&nbsp;&lt;EOL&gt;&nbsp;|&nbsp;&lt;EOL&gt;
&nbsp;&nbsp;&nbsp;&lt;line-content&gt;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;comment&gt;&nbsp;|&nbsp;&lt;assignment&gt;
&nbsp;&nbsp;&nbsp;&lt;comment&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;"#"&nbsp;&lt;any-string&gt;
&nbsp;&nbsp;&nbsp;&lt;assignment&gt;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;name&gt;&nbsp;"="&nbsp;&lt;any-string&gt;
&nbsp;&nbsp;&nbsp;&lt;name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;token-string&gt;
&nbsp;&nbsp;&nbsp;&lt;token-string&gt;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;token-char&gt;&nbsp;|&nbsp;&lt;token-string&gt;&nbsp;&lt;token-char&gt;
&nbsp;&nbsp;&nbsp;&lt;any-string&gt;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;&lt;any-char&gt;&nbsp;|&nbsp;&lt;any-string&gt;&nbsp;&lt;any-char&gt;
&nbsp;&nbsp;&nbsp;&lt;EOL&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;"\r"&nbsp;|&nbsp;"\n"&nbsp;|&nbsp;"\r"&nbsp;"\n"
&nbsp;&nbsp;&nbsp;&lt;token-char&gt;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;[a-zA-Z0-9]&nbsp;|&nbsp;"-"&nbsp;|&nbsp;"_"&nbsp;|&nbsp;"."
&nbsp;&nbsp;&nbsp;&lt;any-char&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;[\x20-\x7f]

</pre>
The only parts which are significant to SAMP clients/hubs are
(a) existence of the file and (b) <tt>&lt;assignment&gt;</tt> lines.

<p></p>
A legal lockfile MUST provide (in any order) unique assignments for the
following tokens:

<dl compact="">
<dt><b><tt>samp.secret</tt></b></dt>
	<dd> -
      An opaque text string which must be passed to the hub to permit
      registration.</dd>
 <dt><b><tt>samp.hub.xmlrpc.url</tt></b></dt>
	<dd> -
      The XML-RPC endpoint for communication with the hub.</dd>
 <dt><b><tt>samp.profile.version</tt></b></dt>
	<dd> -
      The version of the SAMP Standard Profile implemented by the hub
      ("1.3" for the version described by this document).</dd>
</dl>
These keys form the basis of an extensible vocabulary as explained in
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.
Other blank, comment or assignment lines may be included as desired.

<p></p>
An example lockfile might therefore look like this:

<blockquote><tt>
   # SAMP lockfile written 2011-12-22T05:30:01 <br>
   # Required keys: <br>
   samp.secret=734144fdaab8400a1ec2 <br>
   samp.hub.xmlrpc.url=http://andromeda.star.bris.ac.uk:8001/xmlrpc <br>
   samp.profile.version=1.3<br>
   # Info stored by hub for some private reason: <br>
   com.yoyodyne.hubid=c80995f1
</tt></blockquote>

<p></p>
      <h4>
<a name="tth_sEc4.3.4">
4.3.4</a>&nbsp;&nbsp;Hub Discovery Sequences</h4>

<p></p>
The hub discovery sequences are therefore as follows:

<p></p>

<ul>
<li> Client startup:
   
<ul>
<li> Determine hub existence as above
<div class="p"></div>
</li>

<li> If no hub, client MAY start its own hub
<div class="p"></div>
</li>

<li> Acquire <tt>samp.secret</tt> value from lockfile
<div class="p"></div>
</li>

<li> If pre-existing or own hub is running, call <tt>register()</tt> and
         zero or more of <tt>setXmlrpcCallback()</tt>, <tt>declareMetadata()</tt>,
         <tt>declareSubscriptions()</tt>
<div class="p"></div>
</li>
</ul>
<div class="p"></div>
</li>

<li> Hub startup:
   
<ul>
<li> Determine hub existence as above
<div class="p"></div>
</li>

<li> If hub is running, exit
<div class="p"></div>
</li>

<li> Otherwise, start up XML-RPC server
<div class="p"></div>
</li>

<li> Write lockfile containing mandatory assignments including
         XML-RPC endpoint, using appropriate access restrictions
<div class="p"></div>
</li>
</ul>
<div class="p"></div>
</li>

<li> Hub shutdown:
   
<ul>
<li> Remove lockfile (it is RECOMMENDED to first check that this
         is the lockfile written by self)
<div class="p"></div>
</li>

<li> Notify candidate clients that shutdown will occur
<div class="p"></div>
</li>

<li> Shut down services
<div class="p"></div>
</li>
</ul>
<div class="p"></div>
</li>
</ul>
<p></p>
A hub implementation SHOULD make its best effort to perform the
shutdown sequence above even if it terminates as a result of some
error condition.

<p></p>
Note that manipulation of a file is not atomic, so that race conditions
are possible.  For instance a client or hub examining the lockfile
may read it after it has been created but before it has been populated
with the mandatory assignments, or two hubs may look for a lockfile
simultaneously, not find one, and both decide that they should
therefore start up, one presumably overwriting the other's lockfile.
Hub and client implementations should be aware of such possibilities,
but may not be able to guarantee to avoid them or their consequences.
In general this is the sort of risk that SAMP and its
Standard Profile are prepared to take - an eventuality which will occur
sufficiently infrequently that it is not worth significant
additional complexity to avoid.
In the worst case a SAMP session may fail in some way, and will have
to be restarted manually.

<p></p>
     <h3>
<a name="tth_sEc4.4">
4.4</a>&nbsp;&nbsp;Examples</h3>

<p></p>
Here is an example in pseudo-code of how an application might locate and
register with a hub, and send a message requiring no response to other
registered clients.
<font size="-1">

<pre>&nbsp;&nbsp;&nbsp;#&nbsp;Locate&nbsp;and&nbsp;read&nbsp;the&nbsp;lockfile.
&nbsp;&nbsp;&nbsp;string&nbsp;hubvar-value&nbsp;=&nbsp;readEnvironmentVariable("SAMP_HUB");
&nbsp;&nbsp;&nbsp;string&nbsp;lock-location&nbsp;=&nbsp;getLockfileLocation(hubvar-value);
&nbsp;&nbsp;&nbsp;map&nbsp;lock-info&nbsp;=&nbsp;readLockfile(lock-location);

&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;information&nbsp;from&nbsp;lockfile&nbsp;to&nbsp;locate&nbsp;and&nbsp;register&nbsp;with&nbsp;hub.
&nbsp;&nbsp;&nbsp;string&nbsp;hub-url&nbsp;=&nbsp;lock-info.getValue("samp.hub.xmlprc.url");
&nbsp;&nbsp;&nbsp;string&nbsp;samp-secret&nbsp;=&nbsp;lock-info.getValue("samp.secret");

&nbsp;&nbsp;&nbsp;#&nbsp;Establish&nbsp;XML-RPC&nbsp;connection&nbsp;with&nbsp;hub
&nbsp;&nbsp;&nbsp;#&nbsp;(uses&nbsp;some&nbsp;generic&nbsp;XML-RPC&nbsp;library)
&nbsp;&nbsp;&nbsp;xmlrpcServer&nbsp;hub&nbsp;=&nbsp;xmlrpcConnect(hub-url);

&nbsp;&nbsp;&nbsp;#&nbsp;Register&nbsp;with&nbsp;hub.
&nbsp;&nbsp;&nbsp;map&nbsp;reg-info&nbsp;=&nbsp;hub.xmlrpcCall("samp.hub.register",&nbsp;samp-secret);
&nbsp;&nbsp;&nbsp;string&nbsp;private-key&nbsp;=&nbsp;reg-info.getValue("samp.private-key");

&nbsp;&nbsp;&nbsp;#&nbsp;Store&nbsp;metadata&nbsp;in&nbsp;hub&nbsp;for&nbsp;use&nbsp;by&nbsp;other&nbsp;applications.
&nbsp;&nbsp;&nbsp;map&nbsp;metadata&nbsp;=&nbsp;("samp.name"&nbsp;-&gt;&nbsp;"dummy",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"samp.description.text"&nbsp;-&gt;&nbsp;"Test&nbsp;Application",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"dummy.version"&nbsp;-&gt;&nbsp;"0.1-3");
&nbsp;&nbsp;&nbsp;hub.xmlrpcCall("samp.hub.declareMetadata",&nbsp;private-key,&nbsp;metadata);

&nbsp;&nbsp;&nbsp;#&nbsp;Send&nbsp;a&nbsp;message&nbsp;requesting&nbsp;file&nbsp;load&nbsp;to&nbsp;all&nbsp;other&nbsp;
&nbsp;&nbsp;&nbsp;#&nbsp;registered&nbsp;clients,&nbsp;not&nbsp;wanting&nbsp;any&nbsp;response.
&nbsp;&nbsp;&nbsp;map&nbsp;loadParams&nbsp;=&nbsp;("filename"&nbsp;-&gt;&nbsp;"/tmp/foo.bar");
&nbsp;&nbsp;&nbsp;map&nbsp;loadMsg&nbsp;=&nbsp;("samp.mtype"&nbsp;-&gt;&nbsp;"file.load",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"samp.params"&nbsp;-&gt;&nbsp;loadParams);
&nbsp;&nbsp;&nbsp;hub.xmlrpcCall("samp.hub.notifyAll",&nbsp;private-key,&nbsp;loadMsg);

&nbsp;&nbsp;&nbsp;#&nbsp;Unregister
&nbsp;&nbsp;&nbsp;hub.xmlrpcCall("samp.hub.unregister",&nbsp;private-key);

</pre>
</font>

<p></p>
The first few XML-RPC documents sent over the wire for this exchange 
would look something like the following.  
The registration call from the client to the hub:
<font size="-1">

<pre>&nbsp;&nbsp;&nbsp;POST&nbsp;/xmlrpc&nbsp;HTTP/1.0
&nbsp;&nbsp;&nbsp;User-Agent:&nbsp;Java/1.5.0_10
&nbsp;&nbsp;&nbsp;Content-Type:&nbsp;text/xml
&nbsp;&nbsp;&nbsp;Content-Length:&nbsp;189

&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;methodCall&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;methodName&gt;samp.hub.register&lt;/methodName&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;params&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;&lt;value&gt;&lt;string&gt;734144fdaab8400a1ec2&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/params&gt;
&nbsp;&nbsp;&nbsp;&lt;/methodCall&gt;

</pre>
</font>
which leads to the response:
<font size="-1">

<pre>&nbsp;&nbsp;&nbsp;HTTP/1.1&nbsp;200&nbsp;OK
&nbsp;&nbsp;&nbsp;Connection:&nbsp;close
&nbsp;&nbsp;&nbsp;Content-Type:&nbsp;text/xml
&nbsp;&nbsp;&nbsp;Content-Length:&nbsp;464

&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;methodResponse&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.private-key&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;client-key:1a52fdf&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.hub-id&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;client-id:0&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.self-id&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;client-id:4&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;
&nbsp;&nbsp;&nbsp;&lt;/methodResponse&gt;

</pre>
</font>
The client can then declare its metadata:
the response to this call has no useful content so can be ignored or discarded.
<font size="-1">

<pre>&nbsp;&nbsp;&nbsp;POST&nbsp;/xmlrpc&nbsp;HTTP/1.0
&nbsp;&nbsp;&nbsp;User-Agent:&nbsp;Java/1.5.0_10
&nbsp;&nbsp;&nbsp;Content-Type:&nbsp;text/xml
&nbsp;&nbsp;&nbsp;Content-Length:&nbsp;600

&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;methodCall&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;methodName&gt;samp.hub.declareMetadata&lt;/methodName&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;params&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;&lt;value&gt;&lt;string&gt;app-id:1a52fdf-2&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;&lt;value&gt;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.name&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;dummy&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.description.text&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;Test&nbsp;application&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;dummy.version&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;0.1-3&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/params&gt;
&nbsp;&nbsp;&nbsp;&lt;/methodCall&gt;

</pre>
</font>
The message itself is sent from the client to the hub as follows:
<font size="-1">

<pre>&nbsp;&nbsp;&nbsp;POST&nbsp;/xmlrpc&nbsp;HTTP/1.0
&nbsp;&nbsp;&nbsp;User-Agent:&nbsp;Java/1.5.0_10
&nbsp;&nbsp;&nbsp;Content-Type:&nbsp;text/xml
&nbsp;&nbsp;&nbsp;Content-Length:&nbsp;523

&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;methodCall&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;methodName&gt;samp.hub.notifyAll&lt;/methodName&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;params&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;&lt;value&gt;&lt;string&gt;app-id:1a52fdf-2&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;&lt;value&gt;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.mtype&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;file.load&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.params&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;filename&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;/tmp/foo.bar&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/params&gt;
&nbsp;&nbsp;&nbsp;&lt;/methodCall&gt;

</pre>
</font>
Again, there is no interesting response.

<p></p>

 <h2>
<a name="tth_sEc5">
5</a>&nbsp;&nbsp;Web Profile</h2>
<a name="sect:webprofile">
</a>

<p></p>
This section defines the SAMP Web Profile
which allows web applications
to communicate with a SAMP hub.
A <em>web application </em> in this context is code which is downloaded
by a web browser from a remote server, usually as part of a web page,
and which then runs from within that browser.
The most common platforms (browser-based runtime environments) for such
applications are currently JavaScript (a.k.a.&nbsp;JScript, ECMAScript),
Java applets, Adobe Flash, and Microsoft Silverlight.
For security reasons, these runtime environments run the web applications
that they host inside a secure "sandbox", which imposes restrictions
on access to resources, making it impossible to use the Standard Profile
defined in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a>.
Java applets provide a client-controlled cross-browser mechanism, 
based on code signing, for circumventing these restrictions,
but the others do not.

<p></p>
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-overview">5.1</a> gives an illustrative overview of the
way the Web Profile achieves its communication requirements,
with comparison to the Standard Profile.
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-hub">5.2</a> describes in detail how the Web Profile hub
is implemented in order to provide the functionality defined by
the SAMP abstract hub and client APIs
(Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>).
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-client">5.3</a> outlines the steps that a Web Profile client
must take to locate and communicate with the hub.
The important topic of the security implications of this scheme,
and measures which hub implementations can take in view of these,
is covered separately in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-security">5.4</a>.

<p></p>
     <h3>
<a name="tth_sEc5.1">
5.1</a>&nbsp;&nbsp;Overview and Comparison with Standard Profile</h3>
<a name="sect:web-overview">
</a>

<p></p>
The Web Profile is based on the Standard Profile
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a>), but with some
modifications which allow clients to overcome
the restrictions imposed by the browser sandbox.

<p></p>
Browser restrictions present four main problems for a web-based SAMP client:
hub discovery, outward hub communication, inward hub communication and
use of third-party URLs.
These are solved in the Web Profile by use of a well-known port,
use of standard and de facto cross-origin access techniques,
reversed HTTP communication,
and URL proxying.
These solutions are described, with comparison to the approaches
used by the Standard Profile, in the following subsections.

<p></p>
      <h4>
<a name="tth_sEc5.1.1">
5.1.1</a>&nbsp;&nbsp;Hub Discovery</h4>

<p></p>
A Standard Profile client locates the hub by reading a "lockfile" 
at a well-known location in the filesystem, which provides the HTTP
endpoint at which the hub XML-RPC server is listening and a token
which the client must present in order to register.
Web applications have no access to the local filesystem and so
are unable to read such a lockfile.

<p></p>
In the Web profile, the hub HTTP server listens instead
on a well-known port on the local host.
The hub will apply some security measures at registration time
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a>),
but they are not based on presentation of a secret token.

<p></p>
Note that since this well-known port number is fixed,
it is not possible for more than one Web Profile hub to run on
the same host.  The Web Profile Hub and corresponding web browser
MUST run on the same host, and SHOULD always be run by the same user.

<p></p>
For a web client to be able to access this well-known port at all,
the cross-origin techniques discussed in the next section are required.

<p></p>
      <h4>
<a name="tth_sEc5.1.2">
5.1.2</a>&nbsp;&nbsp;Outward Communications</h4>

<p></p>
In the Standard Profile, all hub communication is done using the HTTP-based
XML-RPC protocol [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xmlrpc">7</a>], usually to a port on the local host.

<p></p>
This is problematic for web-based clients, since so-called 
"cross-origin" or "cross-domain" policies
enforced by browsers restrict HTTP access under normal circumstances
so that web applications may <em>only </em> make HTTP requests to
URLs at their own <em>Origin </em> [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#origin">18</a>], that is to URLs on the server
from which the web application itself was downloaded.
This deliberately excludes access to a server on the local host,
which is where the SAMP hub is likely to reside.

<p></p>
Since cross-origin access is a common requirement for web-based clients,
and it is not always in conflict with the security concerns of servers,
a number of platform-dependent but widely-used mechanisms have been 
implemented in browser technology
which allow a sandboxed client to talk to an HTTP server
which has explicitly opted in for such cross-origin communications.
A Web Profile hub will implement one or more of these cross-origin
workarounds (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a>)
and so permit Web Profile clients running in the 
relevant browser runtime environment(s) to make HTTP requests to itself,
thereby allowing client-to-hub XML-RPC calls.

<p></p>
      <h4>
<a name="tth_sEc5.1.3">
5.1.3</a>&nbsp;&nbsp;Inward Communications</h4>

<p></p>
If it wishes to receive as well as send messages, and also to make
asynchronous calls, a SAMP client must declare itself
<em>Callable </em>, by providing the Hub with a profile-dependent means
to invoke the client API defined in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>.

<p></p>
In the Standard Profile a client declares itself Callable by
providing to the Hub an HTTP endpoint to which the Hub may make
XML-RPC requests.  Thus, the client must itself run a publicly
accessible HTTP server in order to be callable.
Running an HTTP server is typically not within the capabilities
of a web application.

<p></p>
In the Web Profile, hub-to-client communication is effected by reversing
the direction of the XML-RPC calls, and hence of the HTTP requests.
Instead of the client running a server which listens
for incoming messages from the Hub, the Hub maintains a queue
of messages destined for the client, and the client polls
the Hub to find out if any are available.  The client may
either make periodic short-timeout requests to the hub, or
make a long-timeout ("long poll") request which will
return early if and when one or more messages are available.
This effects inward communications using only the same outward
HTTP capability discussed in the previous section.

<p></p>
      <h4>
<a name="tth_sEc5.1.4">
5.1.4</a>&nbsp;&nbsp;Third-Party URLs</h4>

<p></p>
Although it is not fundamental to the SAMP protocol itself, many
SAMP MTypes are defined in such a way that a receiving client
must retrieve data from a URL external to the SAMP client-hub system in order
to act on them.  For instance the <tt>table.load.votable</tt> MType
has an argument named "<tt>url</tt>", whose value is the location of
the VOTable document to be loaded.  Such URLs may point
to the local filesystem, to a server run by the sending client,
or to some other web server internal or external to the host on
which the SAMP communications are taking place.
Similar considerations apply to some of the client metadata items
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:app-metadata">3.6</a>), for instance <tt>samp.icon.url</tt>.
In any of these cases, it is likely that a browser-based client 
will be blocked by the browser's cross-origin policy from accessing
the content of the resource in question.

<p></p>
The Web Profile therefore mandates that the Hub must provide to
registered clients a mechanism for translating arbitrary URLs
into cross-origin-accessible URLs with the same content as the
specified resource.  Since a hub must already be providing a
cross-origin capable HTTP service accessible from the web client, 
it can use the same mechanism to operate a service which proxies
external resources in a cross-origin capable way.

<p></p>
     <h3>
<a name="tth_sEc5.2">
5.2</a>&nbsp;&nbsp;Hub Behaviour</h3>
<a name="sect:web-hub">
</a>

<p></p>
This section specifies in detail the services that a SAMP hub must
provide in order to implement the SAMP Web Profile.

<p></p>
The Web Profile is based on client-to-hub XML-RPC calls,
with the hub residing at a well-known port,
and some special measures for allowing cross-origin requests.
In most ways it resembles the Standard Profile (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile">4</a>),
but there are some differences.

<p></p>
      <h4>
<a name="tth_sEc5.2.1">
5.2.1</a>&nbsp;&nbsp;Data Type Mappings</h4>

<p></p>
SAMP argument and return value data types are encoded into XML-RPC
exactly as for the Standard Profile (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:profile-typemap">4.1</a>).

<p></p>
      <h4>
<a name="tth_sEc5.2.2">
5.2.2</a>&nbsp;&nbsp;API Mappings</h4>
<a name="sect:webXMLRPC">
</a>

<p></p>
The operation names in the SAMP hub API very nearly have a one to one
mapping with those in the Web Profile XML-RPC API.  The Web Profile
Hub API MUST be implemented as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a>,
with a number of REQUIRED adjustments.
These are summarised as follows, and described in more detail later.

<p></p>

<ol type="1">
<li> The XML-RPC method names (i.e.&nbsp;the contents of the XML-RPC
      <tt>&lt;methodName&gt;</tt> elements) are formed by prefixing
      the hub abstract API operation names with "<tt>samp.webhub.</tt>".
      For brevity, this prefix is not written in the rest of this document,
      but it is to be understood on all hub API XML-RPC calls.
<div class="p"></div>
</li>

<li> The <tt>register</tt> operation takes the following form
      (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-registration">5.2.4</a>):
      
<ul>
<li> <tt>map reg-info = register(map identity-info)</tt>
<div class="p"></div>
</li>
</ul>
      The <tt>identity-info</tt> is a map containing at least a declared
      application name supplied by the registering application to
      indicate its identity.
<div class="p"></div>
</li>

<li> The <tt>reg-info</tt> map returned from the <tt>register</tt> method
      MUST contain two entries additional to those mandated by the
      hub API (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-registration">5.2.4</a>):
      
<dl compact="">
<dt><b><tt>samp.private-key</tt>:</b></dt>
	<dd>
           used as the first argument of all hub API XML-RPC calls</dd>
 <dt><b><tt>samp.url-translator</tt>:</b></dt>
	<dd>
           used for translation of foreign URLs for cross-origin accessibility</dd>
</dl>
<div class="p"></div>
</li>

<li> <em>All </em> hub methods other than <tt>register</tt>
      take the <tt>private-key</tt> as their first argument,
      except where otherwise noted (<tt>ping</tt>).
      For brevity, this argument is not written in the rest of this document,
      but it is to be understood on all hub API calls.
<div class="p"></div>
</li>

<li> Two new methods are added to the hub API to support reversed callbacks
      (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-callable">5.2.5</a>):
      
<ul>
<li> <tt>allowReverseCallbacks(string allow)</tt>
<div class="p"></div>
</li>

<li> <tt>map pullCallbacks(string timeout)</tt>
<div class="p"></div>
</li>
</ul>
<div class="p"></div>
</li>

<li> Another new method is added to the hub API:
      
<ul>
<li> <tt>ping()</tt>
<div class="p"></div>
</li>
</ul>
      This may be called by registered or unregistered applications
      (as a special case the <tt>private-key</tt> argument may be omitted),
      and can be used to determine whether the hub is responding to requests.
      Any non-error return indicates that the hub is running.
<div class="p"></div>
</li>
</ol>
<p></p>
      <h4>
<a name="tth_sEc5.2.3">
5.2.3</a>&nbsp;&nbsp;Hub HTTP Server</h4>
<a name="sect:web-httpd">
</a>

<p></p>
Communications are XML-RPC calls [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xmlrpc">7</a>] from the client to the Hub.
XML-RPC works using POSTs to an HTTP server.  The Web Profile hub HTTP
server resides on the well-known port 21012,
so that clients know where to find it on the local host.
The XML-RPC endpoint for Web Profile requests
is at the root of that server, so that web clients can access it by
POSTing to the URL "<tt>http://localhost:21012/</tt>".

<p></p>
In general, web applications operate inside a browser-enforced sandbox that
prevents them from accessing cross-origin resources, including HTTP-based ones
served from the local host.  However there are a number of ways in which
an HTTP server can elect to permit access from browser-based clients.
In order to be useful a Web Profile hub must implement at
least one of these "cross-origin workarounds".

<p></p>
The following cross-origin workarounds are known to exist, and
can be considered for use by Web Profile hub HTTP servers:

<dl compact="">
<dt><b>Cross-Origin Resource Sharing:</b></dt>
	<dd>
CORS [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#cors">11</a>] is a W3C standard which
works by manipulation of the HTTP Origin header and related headers
by the browser runtime environment and the HTTP server,
allowing the HTTP server to grant
cross-domain access from clients with some or all Origins.
CORS forms part of the XmlHttpRequest Level 2 standard [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#xhr2">12</a>],
which is implemented by, at least, 
Chrome v2.0+, Firefox v3.5+ and Safari v4.0+.
Microsoft's IE8+ implements CORS via its own non-standard XDomainRequest
object.  
This standard belongs to the loose HTML5 family of technologies,
and it is likely that support will become wider in the future.
A Web Profile hub HTTP server can grant unrestricted access
to CORS-aware web applications
by following the instructions in the CORS standard to enable both 
<em>simple </em> and <em>preflight </em> requests from clients
with any Origin.</dd>
 <dt><b>Flash cross-domain policy:</b></dt>
	<dd> Adobe's Flash browser plugin makes
use of a resource named "<tt>crossdomain.xml</tt>", which, if present on
an external HTTP server, is taken to indicate willingness to serve
cross-domain requests [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#flash-crossdomain">13</a>].
This has emerged as something of a de facto standard, and the
crossdomain file is honoured by Silverlight and unsigned Java
Applets/WebStart applications<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFtNtAAD" name="tthFrefAAD"><sup>3</sup></a>
as well as for Flash applications.
A Web Profile hub HTTP server can grant unrestricted access
to Flash-like web applications
by serving a resource named "<tt>/crossdomain.xml</tt>"
with a Content-Type header of
"<tt>text/x-cross-domain-policy</tt>" and content like:
<font size="-2">
<pre>&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;!DOCTYPE&nbsp;cross-domain-policy
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SYSTEM&nbsp;"http://www.adobe.com/xml/dtds/cross-domain-policy.dtd"&gt;
&nbsp;&nbsp;&nbsp;&lt;cross-domain-policy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;site-control&nbsp;permitted-cross-domain-policies="all"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;allow-access-from&nbsp;domain="*"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;allow-http-request-headers-from&nbsp;domain="*"&nbsp;headers="*"/&gt;
&nbsp;&nbsp;&nbsp;&lt;/cross-domain-policy&gt;

</pre></font>
</dd>
 <dt><b>Silverlight cross-domain policy:</b></dt>
	<dd>
Microsoft's Silverlight environment will take note of Flash-style
<tt>crossdomain.xml</tt> files, so the above measure ought to permit
Silverlight clients to access a compliant HTTP server.  However,
Silverlight has its own cross-domain policy mechanism
[<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#silverlight-crossdomain">14</a>], which may be implemented in addition.
A Web Profile hub HTTP server can grant unrestricted access
to Silverlight web applications
by serving a resource named "<tt>/clientaccesspolicy.xml</tt>"
with a Content-Type header of "<tt>text/xml</tt>" and content like:
<font size="-2">
<pre>&nbsp;&nbsp;&nbsp;&lt;?xml&nbsp;version="1.0"?&gt;
&nbsp;&nbsp;&nbsp;&lt;access-policy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cross-domain-access&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;policy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;allow-from&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;domain&nbsp;uri="http://*"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/allow-from&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;grant-to&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;resource&nbsp;path="/"&nbsp;include-subpaths="true"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/grant-to&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/policy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/cross-domain-access&gt;
&nbsp;&nbsp;&nbsp;&lt;/access-policy&gt;

</pre></font>
</dd>
</dl>
<p></p>
If the hub implements these cross-origin workarounds 
it is believed that cross-origin access, hence Web Profile SAMP access,
can be provided from nearly all browsers.
Most modern browsers support CORS for JavaScript, 
nearly all others support Flash,
and it is possible for JavaScript applications to 
make use of Flash libraries for their
SAMP communications<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFtNtAAE" name="tthFrefAAE"><sup>4</sup></a>.
Maximum interoperability therefore can be achieved by 
implementing all of these, or at least CORS and Flash,
in the Web Profile HTTP server.  
There are however security implications of which ones to implement,
discussed in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-confirm">5.4.2.2</a>.

<p></p>
In the usual browser-hub configuration,
web applications will always seek the Web Profile HTTP server on the
local host.
Since no legitimate use of the Web Profile HTTP server is expected
from non-local hosts, it is therefore strongly RECOMMENDED for 
security reasons that the Web Profile HTTP server refuses
HTTP requests from external hosts with a 403 Forbidden status.
This recommendation and possible exceptions to it are discussed
further in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-host">5.4.2.1</a>.

<p></p>
      <h4>
<a name="tth_sEc5.2.4">
5.2.4</a>&nbsp;&nbsp;Registration</h4>
<a name="sect:web-registration">
</a>

<p></p>
In order to request registration with the Web Profile, a client needs
to invoke the following XML-RPC method:

<pre>&nbsp;&nbsp;&nbsp;map&nbsp;register(map&nbsp;identity-info)

</pre>
The <tt>identity-info</tt> map provides information identifying the
registering application which can inform the
hub's decision about whether to allow registration.
It has the following REQUIRED entry:

<dl compact="">
<dt><b><tt>samp.name</tt></b></dt>
	<dd> -
  A <tt>string</tt> giving the name of the application wishing to register,
  in a form that can be presented to the user.
  This SHOULD be the same as the value of the <tt>samp.name</tt> key in the
  application metadata as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:app-metadata">3.6</a>.</dd>
</dl>
Particular implementations or future versions of this standard
may specify additional required or optional entries to this map.

<p></p>
The hub will accept or reject the registration based on the contents of
the <tt>identity-info</tt> map, available information from the HTTP connection
carrying the XML-RPC call, user confirmation,
and the hub's own security policy, as discussed in <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a>.
The <tt>register</tt> XML-RPC request will not return until the
hub has decided whether to accept registration.
This decision may involve user interaction and hence take a significant
amount of time.
The likely timescales mean that an HTTP timeout is possible 
but not very probable; in case of a timeout, registration fails.

<p></p>
If registration is accepted, the hub MUST return to the client
a SAMP map containing the entries mandated by Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:registration">3.5</a>
and also the following entries:

<p></p>

<dl compact="">
<dt><b><tt>samp.private-key</tt>:</b></dt>
	<dd>
     The value of this key is a string which identifies the registered client.
     This string SHOULD be difficult for third parties to guess.
     This arrangement is the same as for the Standard Profile
     (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:mappingXMLRPC">4.2</a>)</dd>
 <dt><b><tt>samp.url-translator</tt>:</b></dt>
	<dd>
     The value of this key is a string which forms the base for a URL
     proxying service, used as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-urltrans">5.2.6</a>
</dd>
</dl>
<p></p>
If registration is rejected, the hub MUST return to the client
an XML-RPC Fault, which SHOULD have a suitably explanatory
<tt>faultString</tt>.

<p></p>
      <h4>
<a name="tth_sEc5.2.5">
5.2.5</a>&nbsp;&nbsp;Callable Clients</h4>
<a name="sect:web-callable">
</a>

<p></p>
In order to be able to receive communications (incoming messages and
asynchronous call replies) <em>from </em> the hub, the Web Profile
provides for the client to be able to poll the hub server for any
messages or replies which are ready for receipt.
In this way, such communications
are pulled by the client rather than being pushed by the hub, so that
no server component is required on the client side.

<p></p>
Two hub methods are provided to implement this:

<ul>
<li> <tt>allowReverseCallbacks(string allow)</tt>
<div class="p"></div>
</li>

<li> <tt>list pullCallbacks(string timeout-secs)</tt>
<div class="p"></div>
</li>
</ul>
Both these methods, like the others in the interface, are named with the
<tt>samp.webhub.</tt> prefix and take the <tt>private-key</tt> as an additional
first argument.

<p></p>
The <tt>allow</tt> argument of <tt>allowReverseCallbacks</tt> is a
<em>SAMP boolean </em> ("0" for false or "1" for true), and
the <tt>timeout-secs</tt> argument of <tt>pullCallbacks</tt> is a <em>SAMP int</em>
(see Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:scalar-types">3.4</a>).

<p></p>
If a client intends at some time in the future to poll for callbacks
it MUST invoke <tt>allowReverseCallbacks</tt> with a true argument.
If at some later point it decides that it will remain registered but
will never poll for callbacks again it SHOULD invoke 
<tt>allowReverseCallbacks</tt> with a false argument
(most clients will never make this second call).
The client becomes <em>Callable </em> only when it has invoked this
method with a true argument.

<p></p>
Having invoked <tt>allowReverseCallbacks</tt> with a true argument,
the client SHOULD periodically invoke <tt>pullCallbacks</tt> whose
return value gives the details of
any callbacks ready for dispatch to the client.
The <tt>timeout-secs</tt> parameter is the maximum number of seconds the
client wishes to wait for a response.  When the method is called,
the hub SHOULD wait until at least one callback is available, and
at that point SHOULD return any pending callbacks.
If the elapsed time since <tt>pullCallbacks</tt> was received
exceeds the number of seconds given by the <tt>timeout-secs</tt> argument,
the hub SHOULD return with an empty list of callbacks.
A client may therefore make a non-waiting poll by using a 
<tt>timeout-secs</tt> argument of 0.
The hub MAY return with an empty list of callbacks before the
given timeout has elapsed, for instance if it reaches an internal
timeout limit.

<p></p>
The hub MAY discard pending messages before they have been polled for by
the client, for instance to avoid excessive usage of resources to
store them.  If a <tt>receiveCall</tt> for an Asynchronous Call/Response-pattern
message is discarded in this way, the hub SHOULD inform the sender by 
passing back a <tt>samp.code=samp.noresponse</tt>-type error response,
as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.

<p></p>
The format of the returned value from <tt>pullCallbacks</tt> is a <tt>list</tt>
of elements each of which is a <tt>map</tt> representing a callback
corresponding to one of the methods in the SAMP client API
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>).
Each of these callbacks is encoded as a <tt>map</tt> with the
following REQUIRED keys:

<dl compact="">
<dt><b><tt>samp.methodName</tt></b></dt>
	<dd> -
     The client API method name for the callback.
     Its value is a <tt>string</tt> taking one of the values
     "<tt>receiveNotification</tt>", "<tt>receiveCall</tt>" or
     "<tt>receiveResponse</tt>".</dd>
 <dt><b><tt>samp.params</tt></b></dt>
	<dd> -
     A <tt>list</tt> of the parameters taken by the client API method in
     question, as documented in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:clientOps">3.12</a>.</dd>
</dl>
These items correspond to the elements present in an XML-RPC call.

<p></p>
Here is an example of a call to <tt>pullCallbacks</tt>.
The client POSTs an XML-RPC call which requests any callbacks 
which are currently pending or which 
become available during the next 600 seconds:
<font size="-1">
<pre>POST&nbsp;/
Host:&nbsp;localhost:21012
User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;i686;&nbsp;en-US;&nbsp;rv:1.9.2.11)
&nbsp;Gecko/20101028&nbsp;Red&nbsp;Hat/3.6-2.el5&nbsp;Firefox/3.6.11
Referer:&nbsp;http://www.star.bris.ac.uk/~mbt/websamp/sample.html
Content-Length:&nbsp;284
Content-Type:&nbsp;text/plain;&nbsp;charset=UTF-8
Origin:&nbsp;http://www.star.bris.ac.uk

&lt;?xml&nbsp;version='1.0'?&gt;
&lt;methodCall&gt;
&nbsp;&nbsp;&lt;methodName&gt;samp.webhub.pullCallbacks&lt;/methodName&gt;
&nbsp;&nbsp;&lt;params&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;wk:1_fjlyrdtwtigfqhnwkqokqpbq&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;&lt;string&gt;600&lt;/string&gt;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/param&gt;
&nbsp;&nbsp;&lt;/params&gt;
&lt;/methodCall&gt;

</pre></font>
The response, which is returned by the hub after some delay 
between 0 and 600 seconds, specifies a <tt>receiveCall</tt> operation
that the client should respond to:
<font size="-1">
<pre>200&nbsp;OK
Content-Length:&nbsp;1444
Content-Type:&nbsp;text/xml
Access-Control-Allow-Origin:&nbsp;http://www.star.bris.ac.uk

&lt;?xml&nbsp;version='1.0'&nbsp;encoding='UTF-8'?&gt;
&lt;methodResponse&gt;
&nbsp;&nbsp;&lt;params&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;array&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;data&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.methodName&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;samp.webclient.receiveCall&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.params&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;array&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;data&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;hub&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;hub_A_cc55_Ping-tag&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.mtype&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;samp.app.ping&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;samp.params&lt;/name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/data&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/array&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/member&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/struct&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/data&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/array&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/param&gt;
&nbsp;&nbsp;&lt;/params&gt;
&lt;/methodResponse&gt;

</pre></font>
Some of the HTTP headers in the outgoing request in this example
have been added outside of the client's control by the browser 
runtime environment.
In particular the <tt>Origin</tt> inserted by the browser, and the 
<tt>Access-Control-Allow-Origin</tt> provided in response by the Hub,
indicate that CORS negotiation [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#cors">11</a>] is in operation
here to allow cross-origin access.

<p></p>
      <h4>
<a name="tth_sEc5.2.6">
5.2.6</a>&nbsp;&nbsp;URL Translation</h4>
<a name="sect:web-urltrans">
</a>

<p></p>
In order that sandboxed clients are able to obtain the content of
URLs from foreign domains, as is often required by SAMP interoperation,
the hub provides a service which is able to dereference general URLs.

<p></p>
At registration time, as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-registration">5.2.4</a>,
one of the values provided to the registering client is that of the
<tt>samp.url-translator</tt> key.  This is a partial URL which, when
another URL <em>u1 </em> is appended to it, will return the same content as
<em>u1 </em> from an HTTP GET request.  
If <em>u1</em> is a syntactically legal URL according to
RFC 2396 [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2396">15</a>], no additional encoding
needs to be performed on it by the client prior to the concatenation.

<p></p>
A sample of ECMAScript code using this facility might look something
like this:
<font size="-2">
<pre>&nbsp;&nbsp;&nbsp;var&nbsp;url_trans&nbsp;=&nbsp;reg_info["samp.url-translator"];
&nbsp;&nbsp;&nbsp;var&nbsp;u1&nbsp;=&nbsp;msg["samp.params"]["url"];&nbsp;&nbsp;&nbsp;//&nbsp;base&nbsp;URL&nbsp;received&nbsp;from&nbsp;message
&nbsp;&nbsp;&nbsp;var&nbsp;u2&nbsp;=&nbsp;url_trans&nbsp;+&nbsp;u1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;URL&nbsp;ready&nbsp;for&nbsp;retrieval

</pre></font>

<p></p>
The partial translator URL might typically be implemented as a URL
pointing to the same HTTP server in which the hub is hosted, with an
empty query part.  The content of URLs accessed in this way SHOULD be 
available under the same cross-origin arrangements described
in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a>.  For security reasons the hub SHOULD ensure
that this facility can only be used by registered clients, for instance
by embedding the private key in the URL.  Thus a translator URL might
look something like

<blockquote>
<tt>http://localhost:21012/translator</tt>/<i>client-private-key </i><tt>?</tt>
</blockquote>

<p></p>
The URL translation service SHOULD in general write an HTTP response
with HTTP headers appropriate for the resource being served,
in accordance with the HTTP version in use (e.g.&nbsp;[<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2616">16</a>]).
Where the content type of
a resource is not known (which is typical if that resource is backed
by a file rather than an HTTP URI) the HTTP Content-Type header MAY
be omitted.

<p></p>
For security reasons, such a hub URL translation service MAY refuse
access to certain resources, as discussed in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-urls">5.4.3.2</a>.

<p></p>
     <h3>
<a name="tth_sEc5.3">
5.3</a>&nbsp;&nbsp;Client Behaviour</h3>
<a name="sect:web-client">
</a>

<p></p>
The steps that a client must take to register with a Web Profile hub and
participate in two-way SAMP communications are as follows:

<ol type="1">
<li> Prepare to make XML-RPC communications with the XML-RPC endpoint
      <tt>http://localhost:21012/</tt>.
      Web applications will need to do this using a client which
      supports one of the cross-origin workarounds described in
      Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a> and supported by the Web Profile hub.
<div class="p"></div>
</li>

<li> Call the <tt>register</tt>
      XML-RPC method supplying a short application name
      and possibly other information in the <tt>identity-info</tt> argument.
      If this succeeds (returns a non-Fault XML-RPC response),
      the client is registered.
<div class="p"></div>
</li>

<li> If the client wishes to receive as well as send communications
      (to be <em>Callable </em>), first call
      <tt>allowReverseCallbacks</tt> and then
      periodically call <tt>pullCallbacks</tt>.
      Call <tt>declareSubscriptions</tt> as required.
<div class="p"></div>
</li>

<li> Act on retrieved callbacks as required.
      If any MType argument or return value is a URL,
      prefix it with the value of the <tt>samp.url-translator</tt>
      entry from the registration map before dereferencing it.
<div class="p"></div>
</li>

<li> Send SAMP messages etc as required.
<div class="p"></div>
</li>

<li> Unregister when no further SAMP activity is required,
      either because the user requests disconnection or on
      page unload or a similar event.
<div class="p"></div>
</li>
</ol>
<p></p>
     <h3>
<a name="tth_sEc5.4">
5.4</a>&nbsp;&nbsp;Security Considerations</h3>
<a name="sect:web-security">
</a>

<p></p>
Web browsers implement cross-origin access restrictions in order to prevent
web applications from activity on a local host which presents
a security risk, for instance reading and writing local files.
This means that, at least in principle, a user can visit a web page
without worrying about security issues, in a way which is not the
case if they download and install an application to run outside
a browser.

<p></p>
The Web Profile described in the preceding subsections however
relies on neutralising these security measures to some extent.
Although it only affects access to a single resource, the HTTP
server on which the Web Profile hub resides, it is potentially serious
since the services provided by the hub can expose sensitive
resources.

<p></p>
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-analysis">5.4.1</a> below presents an analysis of the risks,
Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-behave">5.4.3</a>
outline how they may be mitigated,
and Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-summary">5.4.4</a> summarises the security status of
Web Profile hub deployments in practice.

<p></p>
      <h4>
<a name="tth_sEc5.4.1">
5.4.1</a>&nbsp;&nbsp;Risk Analysis</h4>
<a name="sect:web-sec-analysis">
</a>

<p></p>
Implementation in the Web Profile of one or more of the sandbox-defeating 
cross-origin workarounds described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a>
allows an untrusted, hence potentially hostile, web application
to make HTTP requests to the Web Profile SAMP hub HTTP server.
In the first instance, there is only one potentially sensitive
action that this access permits: attempting to register
with the SAMP hub.  If the registration attempt is denied,
the web application can perform no useful or potentially dangerous
operations (except for a denial of service attack, which sandboxed
web applications are capable of in any case).
If the registration is granted, the client can perform two classes
of sensitive actions: first, exchange SAMP messages with other clients,
and second, use the hub's URL translation service to access
cross-domain URLs which would normally be blocked by the browser.

<p></p>
In order to protect against security breaches related to the
Web Profile therefore, two lines of defence may be established:
first, exercise control over which web applications are
permitted to register, and second, restrict the actions that 
registered applications are permitted to take.
These options are explored in the following sections,
<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-behave">5.4.3</a> respectively.

<p></p>
      <h4>
<a name="tth_sEc5.4.2">
5.4.2</a>&nbsp;&nbsp;Registration Restrictions</h4>
<a name="sect:web-sec-reg">
</a>

<p></p>
A running Web Profile implementation may receive requests to register
from any web application running in a local browser, and even some
clients in other categories.
Since not all such applications may be trustworthy, the Web Profile
SHOULD exercise careful control over which ones are permitted to register.
A Web Profile implementation is permitted to make such decisions
in accordance with whatever security policy it deems appropriate,
but it is RECOMMENDED that at least the restrictions described in
the following subsections are considered:
restricting requests to the local host (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-host">5.4.2.1</a>),
requiring explicit user confirmation (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-confirm">5.4.2.2</a>)
and attempting client authentication (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-auth">5.4.2.3</a>).

<p></p>

<b>5.4.2.1<a name="tth_sEc5.4.2.1">
    &nbsp;&nbsp;Local Host Restriction</a>
&nbsp;</b>
<a name="sect:web-sec-host">
</a>

<p></p>
As strongly RECOMMENDED in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-httpd">5.2.3</a>, registration requests,
and in fact all access to the hub HTTP server, SHOULD under normal
circumstances only be permitted
from the local host.  This blocks registration attempts from web or
non-web applications on the internet at large.

<p></p>
Given this restriction, the only applications which may attempt to
register with a hub run by user U are therefore:

<ol type="1">
<li> web applications running in a browser run by user U on the local host
<div class="p"></div>
</li>

<li> non-web applications run by user U on the local host
<div class="p"></div>
</li>

<li> web or non-web applications run by users other than U on the local host
<div class="p"></div>
</li>
</ol>
Type 1 are the applications that the Web Profile is designed to serve.
Type 2 are not what the Web Profile is designed for, since they could
use the Standard Profile instead, but they already have user privileges
so present no additional security risk.
Type 3 are potentially problematic, if the host in question is a 
multi-user machine, since they may result in a different user who
is already able to run processes on the local host acquiring access to
the hub-owner's resources (e.g.&nbsp;private files).
In practice the User Confirmation step (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-confirm">5.4.2.2</a>)
should serve to distinguish type 3 from legitimate (type 1) requests,
and the behaviour restrictions described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-behave">5.4.3</a>
will limit any potential damage.

<p></p>
There may be circumstances under which it is appropriate to relax this
local host restriction, for instance to enable collaboration with
a known external host not capable of Standard Profile communication,
such as a mobile device operated by the hub user.
However, it is RECOMMENDED that Web Profile implementations at 
least restrict access to the local host in their default 
configuration, and if access is permitted to external hosts
it is only by explicit user request, and to a named host or
list of hosts.
Opening the well-known Web Profile hub server port to the internet at
large would invite denial of service and perhaps phishing attacks
in which the user is exposed to unwanted SAMP registration 
requests.

<p></p>

<b>5.4.2.2<a name="tth_sEc5.4.2.2">
    &nbsp;&nbsp;User Confirmation</a>
&nbsp;</b>
<a name="sect:web-sec-confirm">
</a>

<p></p>
It is strongly RECOMMENDED that the Hub requires explicit confirmation
from the user before any Web Profile application is allowed to register.
This will normally take the form of the Hub popping up a dialogue window
which requires the user to click "OK" or similar for registration to proceed.
An implication of this is that the Web Profile hub must have access to
the same visual display on which the browser is running, which almost
certainly means the hub and the browser are run by the same user.

<p></p>
When enquiring about authorization the hub should make clear to the
user the security implications of accepting the registration request,
and should also present to the user any known information about
the application attempting to register.
Unfortunately, little such information is guaranteed to be available.
The name declared by the application as part of its registration request
will be present, but the application is free to declare any name,
perhaps a misleading one.
Certain HTTP headers on the incoming request may also be relevant:
the "Origin" header [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#origin">18</a>] will be present for requests
originating from CORS, and
the "Referer" header [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2616">16</a>,section 14.36] may be provided,
though its presence and reliability is dependent on the combination of
browser, platform and cross-origin workaround.
Note that use of non-CORS options might on some browser/plugin
platforms permit faking of HTTP headers<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFtNtAAF" name="tthFrefAAF"><sup>5</sup></a>,
so that if the Web Profile HTTP server implements one of the non-CORS
options alongside CORS this may reduce the reliability of
header information even from HTTP requests which (apparently)
originate from CORS.  These headers should therefore be used with care.

<p></p>
Since only the name, which may be chosen at will by the registering
application, is guaranteed present, this looks on the face of it
like a poor basis on which to accept or reject registration by
a potentially hostile web application.

<p></p>
However, in practice the timing of the request presentation provides
the most useful information about the identity and credibility of
the request.  A user will only see such a popup dialogue at the time
that a web application attempts to register with SAMP.
This will normally be immediately following a deliberate user browser 
action like opening, or clicking a "Register" button on, a web page.
If the user trusts the web page he has just interacted with, 
he can trust the application within it, and should hence authorize 
registration.  If the user does not trust the web page he has 
just interacted with, or if the popup appears at a time when no 
obvious action has been taken to trigger a SAMP registration,
then the user should deny registration.
This pattern of user interaction, requiring authorization based on
the timing of actions in a browser, is both intuitive and familiar
to users; for instance it is used when launching a signed Java applet
or Java WebStart application.

<p></p>

<b>5.4.2.3<a name="tth_sEc5.4.2.3">
    &nbsp;&nbsp;Client Authentication</a>
&nbsp;</b>
<a name="sect:web-sec-auth">
</a>

<p></p>
As an additional security measure it would be desirable to make a
reliable identification of the author of a web application
by examining an associated digital certificate, with reference
to a list of trusted certificate authorities.
If a certificate reliably associated with the application could be
obtained, this additional information could be presented
to the user or used automatically by the hub to inform the decision
about whether to accept or reject the registration request.

<p></p>
Unfortunately however the content of the actual application is not
available to the Hub at registration time,
so signing the application code will not in itself help.

<p></p>
The Web Profile does not at present therefore make any recommendation
concerning client authentication.  Implementations may however
wish to attempt some level of authentication, perhaps by somehow 
associating a certificate with the web client's URL or Origin 
using the HTTP (or HTTPS) request headers noted in 
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-confirm">5.4.2.2</a>, or by use of additional
credentials passed in the <tt>identity-info</tt> map.

<p></p>
      <h4>
<a name="tth_sEc5.4.3">
5.4.3</a>&nbsp;&nbsp;Behaviour Restrictions</h4>
<a name="sect:web-sec-behave">
</a>

<p></p>
Given the restrictions on client registration recommended by
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a>, there is a reasonable expectation
that clients registered with the Web Profile will be trustworthy.
However, the possibility remains that user carelessness or
some phishing-like attack might lead to registration of hostile
clients, and so Web Profile implementations may additionally restrict
the behaviour of registered clients.
In general, a Web Profile hub implementation MAY impose such restrictions
as it sees fit, based on its chosen security policy.
This may lead to the inability of some Web Profile clients
to perform some legitimate SAMP operations;
in such cases the hub SHOULD signal that fact to the client
using an appropriate error mechanism.

<p></p>
Restrictions may be applied as described in the following subsections:
restricting the MTypes that may be sent (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-mtypes">5.4.3.1</a>),
and restricting the scope of the URL translation service
(Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-urls">5.4.3.2</a>).

<p></p>

<b>5.4.3.1<a name="tth_sEc5.4.3.1">
    &nbsp;&nbsp;MType Restrictions</a>
&nbsp;</b>
<a name="sect:web-sec-mtypes">
</a>

<p></p>
The SAMP standard imposes no restriction on the semantics of MTypes,
so SAMP can in principle be used to send messages which exercise
the privileges available to other SAMP clients in arbitrary ways.
In practice, most SAMP MTypes are fairly harmless; a typical result
is loading an image into an image viewer.  While hostile
abuse of such a capability could be annoying, it does not consitute
a serious security concern.  However one might imagine an MType
that intentionally or unintentionally allowed execution of 
arbitrary scripting operations within the context of a connected
client, and hostile abuse of such a facility could easily result
in theft of or damage to data, or in other serious security breaches.

<p></p>
With this in mind, Web Profile hub implementations MAY
impose some restrictions on the MTypes that registered clients are
permitted to send, via for instance some per-MType whitelisting
or blacklisting mechanism.  Given the open-ended nature of the MType
vocabulary, a whitelisting approach may be most appropriate.

<p></p>
The hub MAY also restrict MTypes that Web Profile registered clients
are permitted to receive, though it is harder to imagine exploits
based on message receipt.

<p></p>
Hubs may implement such message blocking either by hiding
blocked subscriptions from other clients as appropriate,
or by refusing to forward messages corresponding to blocked subscriptions.
In the latter case a communication failure should be signalled
by responding with an XML-RPC fault.

<p></p>

<b>5.4.3.2<a name="tth_sEc5.4.3.2">
    &nbsp;&nbsp;URL Restrictions</a>
&nbsp;</b>
<a name="sect:web-sec-urls">
</a>

<p></p>
As explained in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-urltrans">5.2.6</a>, the Web Profile
provides a service for proxying arbitrary URLs, so that
web clients can access data referenced by URL in SAMP messages
or metadata, which sandbox-imposed cross-origin restrictions would 
otherwise block them from reading.

<p></p>
This capability is essential for worthwhile use of many common
SAMP MTypes.
However, it is also open to abuse, for instance a hostile client 
might request to read <tt>file:///etc/passwd</tt> or some HTTP URL 
on the local host or network which is restricted to local access.

<p></p>
Web Profile implementations therefore MAY impose such restrictions
as they see fit on the use of the URL translation service provided
to web clients, in order to prevent such abuse.
Blocking all access to resources which are local
(<tt>file:</tt> or <tt>http://localhost/</tt>) is too strict to be useful,
since the URLs referenced in SAMP messages very often
fall into this category.

<p></p>
An appropriate policy might be to proxy only
URLs which a web client is known to have some legitimate
SAMP-based reason to access, namely those which have previously appeared
in the metadata declared by,
or in a message or response originating from, some other client.
In consideration of the fact that web clients might be able to
provoke other clients to emit a chosen URL, or might cooperate
between themselves, such a list of permitted values SHOULD 
be further restricted to those URLs which first appeared
in a metadata or message content or response map from a trusted 
(i.e.&nbsp;non-web) client.

<p></p>
Since the hub in general lacks the relevant semantic knowledge
there is no foolproof way to identify URLs in metadata or messages,
but checking for syntactically suitable map values
(e.g. <tt>(http - https - ftp - file)://.*</tt>)
is likely to be good enough for this purpose.

<p></p>
Where the Web Profile implementation declines a given URL proxy
request, it MUST respond with a 403 Forbidden HTTP response.

<p></p>
It is also RECOMMENDED that proxied HTTP access is limited to
the "safe" HTTP methods GET and optionally HEAD
[<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#rfc2616">16</a>,section 9.1.1],
and that user credentials (cookies, authentication etc) are not propagated.
Requests using unsupported HTTP methods MUST be met with a
405 Method Not Allowed response.

<p></p>
      <h4>
<a name="tth_sEc5.4.4">
5.4.4</a>&nbsp;&nbsp;Security Summary</h4>
<a name="sect:web-sec-summary">
</a>

<p></p>
The basic mechanics of the Web Profile present significant security risks
for a host on which it runs.  This section has described how
security-conscious implementations of the Profile can mitigate those risks.
Following the recommendations from Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-reg">5.4.2</a>
on when to permit registration provides a reasonable assurance that
registered clients will be trustworthy, and in particular guarantees
that clients can only register with explicit authorization from a 
human user.
Following the recommendations from Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:web-sec-behave">5.4.3</a>
about permitted behaviour of registered clients
ensures that even if a hostile client is allowed to register
it is unlikely to be able to do significant damage.
By combining these measures it is believed that the level of risk
associated with running a Web Profile, while it would not be appropriate
for instance for financial transactions, is no greater than that
encountered on a regular basis by use of the web in general.

<p></p>
The mitigation measures are presented as (in some cases strong)
RECOMMENDations and suggestions rather than REQUIREments,
in order to allow implementations to
experiment with the most appropriate configurations, which may change
as a result of emerging technology and common usage patterns.
Such experimentation and further consideration may result in some 
modification of the protocol or documentation of best practice in
future versions of this document or elsewhere.

<p></p>

 <h2>
<a name="tth_sEc6">
6</a>&nbsp;&nbsp;MTypes: Message Semantics and Vocabulary</h2>
<a name="sect:mtypes">
</a>

<p></p>
        A message contains an MType string that
defines the semantic meaning of the message, for example a request for
another application to load a table.
The concept behind the MType
is similar to that of a UCD [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#ucd">19</a>] 
in that a small vocabulary is sufficient to
describe the expected range of concepts required by a messaging system
within the current scope of the SAMP protocol.
Developers are free to introduce new MTypes for use within applications
without restriction; new MTypes intended to be used for Hub messaging or
other administrative purposes within the messaging system should be discussed
within the IVOA for approval as part of the SAMP standard.

<p></p>
     <h3>
<a name="tth_sEc6.1">
6.1</a>&nbsp;&nbsp;The Form of an MType</h3>

<p></p>
        MType syntax is formally defined in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a>.
Like a UCD, an MType is made up of <em>atoms</em>.
These are not only meaningful to the developer, but form the central
concept of the message.  
Because the capabilities one application is searching for
are loosely coupled with the details of what another may provide,
there is not a rigorous definition of the <em>behavior</em> that
an MType must provoke in a receiver.  Instead, the MType defines a specific
semantic message such as "display an image", and it is up to the receiving
application to determine how it chooses to do the display (e.g.&nbsp;a rendered
greyscale image within an application or displaying the image in a web
browser might both be valid for the recipient and faithful to the meaning
of the message).

<p></p>
        The ordering of the words in an MType SHOULD normally use the
object of the message followed by the action to be performed (or the
information about that object).  For example, the use of "<tt>image.display</tt>"
is preferred to "<tt>display.image</tt>" in order to keep the number of top-level
words (and thus message classes) like `image' small, but still allow for a
wide variety of messages to be created that can perform many useful actions
on an image.  If no existing MType exists for the required purpose,
developers can agree to the use of a new MType such as
"<tt>image.display.extnum</tt>" if, e.g., the ability to display a specific image
extension number warrants a new MType.

<p></p>
     <h3>
<a name="tth_sEc6.2">
6.2</a>&nbsp;&nbsp;The Description of an MType</h3>
<a name="sect:mtype-doc">
</a>

<p></p>
In order that senders and recipients can agree on what is meant by 
a given message, the meaning of an MType must be clearly documented.
This means that for a given MType the following information must be
available:

<ol type="1">
<li> The MType string itself
<div class="p"></div>
</li>

<li> A list of zero or more named parameters
<div class="p"></div>
</li>

<li> A list of zero or more named returned values
<div class="p"></div>
</li>

<li> A description of the meaning of the message
<div class="p"></div>
</li>
</ol>
For each of the named parameters, and each of the returned values,
the following information must be provided:

<ul>
<li> name
<div class="p"></div>
</li>

<li> data type (<tt>map</tt>, <tt>list</tt> or <tt>string</tt>
    as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:samp-data-types">3.3</a>) and if appropriate
    scalar sub-type (see Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:scalar-types">3.4</a>)
<div class="p"></div>
</li>

<li> meaning
<div class="p"></div>
</li>

<li> whether it is OPTIONAL (considered REQUIRED unless stated otherwise)
<div class="p"></div>
</li>

<li> OPTIONAL parameters MAY specify what default will be used
         if the value is not supplied
<div class="p"></div>
</li>
</ul>
Together, this is much the same information as should be given for
documentation of a public interface method in a weakly-typed programming
language.

<p></p>
The parameters and return values associated with each MType 
form extensible vocabularies as explained in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>,
except that there is no reserved "<tt>samp.</tt>" namespace.

<p></p>
Note that it is possible for the MType to have no returned values.
This is actually quite common if the MType does not represent a
request for data.  It is not usually necessary to define a status-like
return value (success or failure),
since this information can be conveyed as the value of the <tt>samp.status</tt>
entry in the call response as described in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a>.

<p></p>
     <h3>
<a name="tth_sEc6.3">
6.3</a>&nbsp;&nbsp;MType Vocabulary: Extensibility and Process</h3>

<p></p>
The set of MTypes forms an extensible vocabulary along the lines of
Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a>.
The relatively small set of MTypes in the "<tt>samp.</tt>" namespace is
defined in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:admin-mtypes">6.4</a> of this document,
but applications will need to use a wider range of MTypes to exchange
useful information.
Although clients are formally permitted to
define and use any MTypes outside of the reserved "<tt>samp.</tt>" namespace,
for effective interoperability there must be
public agreement between application authors on this unreserved vocabulary
and its semantics.

<p></p>
Since addition of new MTypes is expected to be ongoing, 
MTypes from this broader vocabulary will
be documented
outside of this document to avoid the administrative
overhead and delay associated with the IVOA Recommendation Track [<a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#docstd">20</a>].
At time of writing, the procedures for maintaining the list of
publicly-agreed MTypes are quite informal.
These procedures remain under review,
however the current list and details of best practice for adding to it 
are, and will remain, available in some form from the URL
<a href="http://www.ivoa.net/samp/"><tt>http://www.ivoa.net/samp/</tt></a>.

<p></p>
     <h3>
<a name="tth_sEc6.4">
6.4</a>&nbsp;&nbsp;Core MTypes</h3>
<a name="sect:admin-mtypes">
</a>

<p></p>
This section defines those MTypes currently in the "<tt>samp.</tt>" hierarchy.
These are the "administrative"-type MTypes which are core to the
SAMP architecture or widely applicable to SAMP applications.

<p></p>
      <h4>
<a name="tth_sEc6.4.1">
6.4.1</a>&nbsp;&nbsp;Hub Administrative Messages</h4>
<a name="sect:hub-mtypes">
</a>

<p></p>
The following MTypes are for messages which SHOULD be broadcast by the hub
in response to changes in hub state.  By subscribing to these messages,
clients are able to keep track of the current set of registered applications
and of their metadata and subscriptions.
In general, non-hub clients SHOULD NOT send these messages.

   
<dl compact="">
<dt><b><tt>samp.hub.event.shutdown</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD broadcast this message just before it exits.
          It SHOULD also send it to clients who are registered using a
          given profile if that profile is about to shut down, even if
          the hub itself will continue to operate.
          The hub SHOULD make every effort to broadcast this message even in
          case of an exit due to an error condition.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.hub.event.register</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>id</tt> (<tt>string</tt>) -</b></dt>
	<dd> Public ID of newly registered client</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD broadcast this message every time a client 
          successfully registers.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.hub.event.unregister</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>id</tt> (<tt>string</tt>) -</b></dt>
	<dd> public ID of unregistered client</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD broadcast this message every time a client
          unregisters.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.hub.event.metadata</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>id</tt> (<tt>string</tt>) -</b></dt>
	<dd> public ID of client declaring metadata
          </dd>
 <dt><b><tt>metadata</tt> (<tt>map</tt>) -</b></dt>
	<dd> new metadata declared by client</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD broadcast this message every time a client
          declares its metadata.
          The <tt>metadata</tt> argument is exactly as passed using the
          <tt>declareMetadata()</tt> method.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.hub.event.subscriptions</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>id</tt> (<tt>string</tt>) -</b></dt>
	<dd> public ID of subscribing client
          </dd>
 <dt><b><tt>subscriptions</tt> (<tt>map</tt>) -</b></dt>
	<dd> new subscriptions declared by client</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD broadcast this message every time a client 
          declares its subscriptions.
          The <tt>subscriptions</tt> argument is exactly as passed using the
          <tt>declareSubscriptions()</tt> method, and hence may contain wildcarded
          MType strings.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.hub.disconnect</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>reason</tt> (<tt>string</tt>) -</b></dt>
	<dd> (OPTIONAL)
                                    Short text message indicating the reason
                                    that the disconnection is being forced</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>The hub SHOULD send this message to a client if the hub intends to disconnect that
          client forcibly.  This indicates that no further communication
          from that client is welcome, and any such attempts may be
          expected to fail.
          The hub may wish to disconnect clients forcibly as a result of
          some hub timeout policy or for other reasons.</dd>
</dl>
</dd>
</dl>
<p></p>
      <h4>
<a name="tth_sEc6.4.2">
6.4.2</a>&nbsp;&nbsp;Client Administrative Messages</h4>

<p></p>
The following messages are generic messages defined for client use.

   
<dl compact="">
<dt><b><tt>samp.app.ping</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>Diagnostic used to indicate whether an application is 
          currently responding.
          No "status"-like return value is defined,
          since in general any response will indicate aliveness,
          and the normal <tt>samp.status</tt> key in the response may be
          used to indicate any abnormal state.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.app.status</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>txt</tt> (<tt>string</tt>) -</b></dt>
	<dd> Textual indication of status</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>General purpose message to indicate application status.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.app.event.shutdown</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>Indicates that the sending application is going to shut down.
          Note that sending this message is not a substitute for unregistering
          with the hub - registered clients about to shut down 
          SHOULD always explicitly unregister.</dd>
</dl>
</dd>
</dl>
<p></p>

   
<dl compact="">
<dt><b><tt>samp.msg.progress</tt>:</b></dt>
	<dd>

<dl compact="">
<dt><b>Arguments:</b></dt>
	<dd>
<dl compact="">
<dt><b><tt>msgid</tt> (<tt>string</tt>) -</b></dt>
	<dd> Message ID of a previously received message
          </dd>
 <dt><b><tt>txt</tt> (<tt>string</tt>) -</b></dt>
	<dd> Textual indication of progress
          </dd>
 <dt><b><tt>percent</tt> (<tt>string</tt>) -</b></dt>
	<dd> (OPTIONAL)
                                     SAMP float value giving the approximate 
                                     percentage progress
          </dd>
 <dt><b><tt>timeLeft</tt> (<tt>string</tt>) -</b></dt>
	<dd> (OPTIONAL)
                                      SAMP float value giving the estimated
                                      time to completion in seconds</dd>
</dl>
</dd>
 <dt><b>Return Values:</b></dt>
	<dd>
<dl compact="">
<dt><b><em>none</em></b></dt>
	<dd></dd>
</dl>
</dd>
 <dt><b>Description:</b></dt>
	<dd>Reports on progress of a message previously received by the sender
          of this message.  Such progress reports MAY be sent at intervals
          between the receipt of the message and sending a reply.
          Note that the <tt>msg-id</tt> of the earlier message must be passed to
          identify it - the sender of the earlier message (the recipient of
          this one) will have to have retained it from the return value of the
          relevant <tt>call*()</tt> method to match progress reports with
          requests.</dd>
</dl>
</dd>
</dl>
<p></p>
 <h2>
<a name="tth_sEcA">
A</a>&nbsp;&nbsp;Changes between PLASTIC and SAMP</h2>

<p></p>
In order to facilitate the transition from PLASTIC to SAMP from an
application developer's point of view, we summarize in this Appendix 
the main changes. 
In some cases the reasons for these are summarized as well.

<p></p>

<dl compact="">
<dt><b>Language Neutrality:</b></dt>
	<dd>
   PLASTIC contained some Java-specific ideas and details, in particular
   an API defined by a Java interface, use of Java RMI-Lite as a 
   transport protocol option, and a lockfile format
   based on java Property serialization.
   No features of SAMP are specific to, or defined with reference to, Java
   (or to any other programming language).</dd>
 <dt><b>Profiles:</b></dt>
	<dd>
   The formal notion of a SAMP Profile replaces the choices of transport
   protocol in PLASTIC.</dd>
 <dt><b>Nomenclature:</b></dt>
	<dd>
   Much of the terminology has changed between PLASTIC and SAMP,
   in some cases to provide better consistency with common usage in
   messaging systems.
   There is not in all cases a one-to-one correspondence betweeen PLASTIC and
   SAMP concepts, but a partial translation table is as follows:
   
<center>
   
<table>
<tbody><tr>
<td>PLASTIC                </td>
<td>SAMP  </td>
</tr>
<tr>
<td>message                </td>
<td>MType         </td>
</tr>
<tr>
<td>support a message      </td>
<td>subscribe to an MType  </td>
</tr>
<tr>
<td>registered application </td>
<td>client </td>
</tr>
<tr>
<td>synchronous request    </td>
<td>synchronous call/response  </td>
</tr>
<tr>
<td>asynchronous request   </td>
<td>notification 
   </td>
</tr>
</tbody></table>
</center>
</dd>
 <dt><b>MTypes:</b></dt>
	<dd>
   In PLASTIC message semantics were defined using opaque URIs such as
   <tt>ivo://votech.org/hub/event/HubStopping</tt>.  
   SAMP replaces these with a vocabulary of structured MTypes
   such as <tt>samp.hub.event.shutdown</tt>.</dd>
 <dt><b>Asynchrony:</b></dt>
	<dd>
   Responses from messages in PLASTIC were returned synchronously, using
   blocking methods at both sender and recipient ends.  As well as 
   inhibiting flexibility, this risked timeouts for long processing times
   at the discretion of the underlying transport.
   The basic model in SAMP relies on asynchronous responses, though 
   a synchronous faade hub method is also provided for 
   convenience of the sender.
   Client toolkits may also wish to provide client-side synchronous 
   faades based on fully asynchronous messaging.</dd>
 <dt><b>Registration:</b></dt>
	<dd>
   In PLASTIC clients registered with a single call which acquired a
   hub connection and declared callback information, message subscriptions, 
   and some metadata.
   In SAMP, these four operations have been decomposed into separate calls.
   As well as being tidier, this offers benefits such as meaning that
   the subscriptions and metadata can be updated during the lifetime of
   the connection.</dd>
 <dt><b>Client Metadata:</b></dt>
	<dd>
   PLASTIC stored some application metadata (Name) in the hub and provided
   acess to others (Description, Icon URL, ...) using custom messages.
   SAMP stores it all in the hub providing better extensibility and consistency
   as well as improving metadata provision for non-callable applications
   and somewhat reducing traffic and burden on applications.</dd>
 <dt><b>Named Parameters:</b></dt>
	<dd>
   The parameters for PLASTIC messages were identified by sequence
   (forming a list), while
   the parameters for SAMP MTypes are identified by name (forming a map).
   As well as improving documentability, this makes it much more convenient
   to allow for optional parameters or to introduce new ones.
   The same arrangement applies to return values.</dd>
 <dt><b>Recipient Targetting:</b></dt>
	<dd>
   PLASTIC featured methods for sending messages to all or to an explicit list 
   of recipients.  In practice the list variants were rarely used except to
   send to a single recipient.
   SAMP has methods for sending to all or to a single recipient.</dd>
 <dt><b>Typing:</b></dt>
	<dd>
   Data types in PLASTIC were based partly on Java and partly on XML-RPC types.
   There was not a one-to-one correspondence between types in the Java-RMI
   transport and the XML-RPC one, which encouraged confusion.
   Parameter types included integer, floating point and boolean as well as
   string, which proved problematic to use correctly from some 
   weakly-typed languages.
   SAMP uses a more restricted set of types 
   (namely string, list and map) at the protocol level,
   along with some auxiliary rules for encoding numbers and booleans as strings.</dd>
 <dt><b>Lockfile:</b></dt>
	<dd>
   The lockfile in SAMP's standard profile is named <tt>.samp</tt>,
   its format is defined explicitly rather than with reference
   to Java documentation, and there is better provision for its 
   location in a language-independent way on MS Windows systems.
   In many cases however, the same lockfile location/parsing code 
   will work for both SAMP and PLASTIC except for the different filenames
   (".samp" vs.&nbsp;".plastic").</dd>
 <dt><b>Public/Private ID:</b></dt>
	<dd>
   In PLASTIC a single, public ID was used to label and identify 
   applications during communications directed to the hub
   or to other applications.
   This meant that applications could easily, if they wished, 
   impersonate other applications.  The practice in SAMP is to
   use different IDs for public labelling and private identification,
   which means that such "spoofing" is no longer a danger.</dd>
 <dt><b>Errors:</b></dt>
	<dd>
   SAMP has provision to return more structured error information 
   than PLASTIC did.</dd>
 <dt><b>Extensibility:</b></dt>
	<dd>
   Although PLASTIC was in some ways extensible, SAMP provides more hooks
   for future extension, in particular by pervasive use of the 
   <em>extensible vocabulary </em> pattern.</dd>
</dl>
<p></p>
 <h2>
<a name="tth_sEcB">
B</a>&nbsp;&nbsp;Change History</h2>
<a name="sect:changes">
</a>

<p></p>
Changes to SAMP between Working Draft version 1.0 (2008-06-25) and
Recommendation version 1.11 (2009-04-21):

<ul>
<li> Return values of <tt>callAll</tt> and <tt>notifyAll</tt> operations changed;
      they now return information about clients receiving the messages
      (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hubOps">3.11</a>).
<div class="p"></div>
</li>

<li> Characters allowed in <tt>string</tt> type restricted to avoid
      problems transmitting over XML;
      was 0x01-0x7f, now 0x09, 0x0a, 0x0d, 0x20-0x7f
      (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:samp-data-types">3.3</a>).
<div class="p"></div>
</li>

<li> New hub administrative message <tt>samp.hub.disconnect</tt>
      (Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:hub-mtypes">6.4.1</a>).
<div class="p"></div>
</li>

<li> Empty placeholder appendix on SAMP/PLASTIC interoperability removed.
<div class="p"></div>
</li>

<li> Wording clarified and made more explicit in a few places.
<div class="p"></div>
</li>

<li> Typos fixed, including incorrect BNF in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a>.
<div class="p"></div>
</li>

<li> Author list re-ordered.
<div class="p"></div>
</li>

<li> Editorial changes and clarifications following RFC period.
<div class="p"></div>
</li>

<li> MType Vocabulary section now directs readers to
      <tt>http://www.ivoa.net/samp/</tt> to find current MType list and process.
<div class="p"></div>
</li>
</ul>
<p></p>
Changes to SAMP between Recommendation version 1.11 (2009-04-21) and
version 1.2 (2010-12-16):

<ul>
<li> Use of new SAMP_HUB environment variable lockfile location option
      documented in section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:lockfile">4.3</a>.
<div class="p"></div>
</li>

<li> Added Non-Technical Preamble section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:nonTechPreamble">1.1</a>
      as per agreement for all new/revised IVOA documents.
<div class="p"></div>
</li>
</ul>
<p></p>
Changes to SAMP between Recommendation version 1.2 (2010-12-16) and
version 1.3 (2012-04-11):

<ul>
<li> Add a new Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:webprofile">5</a> on the Web Profile.
      Minor changes in the rest of the document noting the existence
      of this new Profile.
<div class="p"></div>
</li>

<li> Add a new Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:security">2.8</a> discussing security issues
      in general, with reference to their particular consideration for
      both Standard and Web Profiles.  The discussion of Standard Profile
      security is moved to its own new Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:std-security">4.3.2</a>.
<div class="p"></div>
</li>

<li> MType syntax declaration in Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:subscription">3.7</a> now permits
      upper-case letters (for consistency with actual usage).
<div class="p"></div>
</li>

<li> Sections <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:response-encode">3.9</a> and <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:faults">3.13</a> now note
      that the hub is permitted to generate and forward an error response
      on behalf of a client under some circumstances.
      The <tt>samp.code=samp.noresponse</tt> code is reserved for
      this purpose.
<div class="p"></div>
</li>

<li> Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:vocab">2.6</a> now reserves a namespace "<tt>x-samp</tt>"
      for keys in an extensible vocabulary which are proposed
      for possible future introduction into this standard.
<div class="p"></div>
</li>

<li> A comment has been added to Section <a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#sect:samp-data-types">3.3</a>
      concerning recommended protocols for use with URLs in messages.
<div class="p"></div>
</li>
</ul>
<p></p>

<p></p>
<h2>References</h2>

<dl compact="">
<dt><a name="architecture">[1]</a></dt>
<dd>
   C.&nbsp;Arviset et al.,
   "<a href="http://www.ivoa.net/Documents/Notes/IVOAArchitecture/index.html">IVOA Architecture</a>", IVOA Note, 2010
</dd>
 <dt><a name="2000A+AS..143...33B">[2]</a></dt>
<dd>
   F.&nbsp;Bonnarel, P.&nbsp;Fernique, O.&nbsp;Bienaym, D.&nbsp;Egret, F.&nbsp;Genova,
   M.&nbsp;Louys, F.&nbsp;Ochsenbein, M.&nbsp;Wenger, and J.&nbsp;G. Bartlett,
   "The ALADIN interactive sky atlas. A reference tool for
   identification of astronomical sources",
   <em>A&amp;AS</em>, 143:33-40, 2000
</dd>
 <dt><a name="2007HiA....14..622B">[3]</a></dt>
<dd>
   U.&nbsp;Becciani, M.&nbsp;Comparato, A.&nbsp;Costa, C.&nbsp;Gheller, B.&nbsp;Larsson,
   F.&nbsp;Pasian, and R.&nbsp;Smareglia.
   "VisIVO: an interoperable visualisation tool for Virtual Observatory data",
   <em>Highlights of Astronomy</em>, 14:622-622, 2007
</dd>
 <dt><a name="xpa">[4]</a></dt>
<dd>
   <a href="http://hea-www.harvard.edu/RD/xpa/"><tt>http://hea-www.harvard.edu/RD/xpa/</tt></a>
</dd>
 <dt><a name="plastic">[5]</a></dt>
<dd>
   J.&nbsp;Taylor, T.&nbsp;Boch, M.&nbsp;Comparato, M.&nbsp;Taylor, and N.&nbsp;Winstanley.
   "<a href="http://ivoa.net/Documents/latest/PlasticDesktopInterop.html">PLASTIC - a protocol for desktop application interoperability</a>",
   IVOA Note, 2006
</dd>
 <dt><a name="plastic-sf">[6]</a></dt>
<dd>
   <a href="http://plastic.sourceforge.net/"><tt>http://plastic.sourceforge.net/</tt></a>
</dd>
 <dt><a name="xmlrpc">[7]</a></dt>
<dd>
   <a href="http://www.xmlrpc.com/"><tt>http://www.xmlrpc.com/</tt></a>
</dd>
 <dt><a name="rfc2119">[8]</a></dt>
<dd>
   S.&nbsp;Bradner,
   <a href="http://www.rfc-editor.org/rfc/rfc2119.txt">RFC&nbsp;2119</a>:
   "Key words for use in RFCs to Indicate Requirement Levels",
   IETF Request For Comments, 1997
</dd>
 <dt><a name="rfc1738">[9]</a></dt>
<dd>
   T.&nbsp;Berners-Lee, L.&nbsp;Masinter, M.&nbsp;McCahill,
   <a href="http://www.rfc-editor.org/rfc/rfc1738.txt">RFC&nbsp;1738</a>:
   "Uniform Resource Locators (URL)",
   IETF Request For Comments, 1994
</dd>
 <dt><a name="rfc2246">[10]</a></dt>
<dd>
   T.&nbsp;Dierks, C.&nbsp;Allen,
   <a href="http://www.rfc-editor.org/rfc/rfc2246.txt">RFC&nbsp;2246</a>:
   "The TLS Protocol",
   IETF Request For Comments, 1999
</dd>
 <dt><a name="cors">[11]</a></dt>
<dd>
   A.&nbsp;van&nbsp;Kesteren (Ed.),
   "<a href="http://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a>",
   W3C Working Draft, 2010
</dd>
 <dt><a name="xhr2">[12]</a></dt>
<dd>
   A.&nbsp;van&nbsp;Kesteren (Ed.),
   "<a href="http://www.w3.org/TR/XMLHttpRequest2/">XMLHttpRequest Level 2</a>",
   W3C Working Draft, 2012
</dd>
 <dt><a name="flash-crossdomain">[13]</a></dt>
<dd>
   Adobe Flash cross-domain policy,
   <a href="http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html"><tt>http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html</tt></a>
</dd>
 <dt><a name="silverlight-crossdomain">[14]</a></dt>
<dd>
   Microsoft Silverlight cross-domain policy,
   <a href="http://msdn.microsoft.com/en-us/library/cc645032(VS.95).aspx"><tt>http://msdn.microsoft.com/en-us/library/cc645032(VS.95).aspx</tt></a>
</dd>
 <dt><a name="rfc2396">[15]</a></dt>
<dd>
   T.&nbsp;Berners-Lee et al.,
   <a href="http://www.rfc-editor.org/rfc/rfc2396.txt">RFC&nbsp;2396</a>:
   "Uniform Resource Identifiers (URI): Generic Syntax",
   IETF Request For Comments, 1998
</dd>
 <dt><a name="rfc2616">[16]</a></dt>
<dd>
   R.&nbsp;Fielding et al.,
   <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC&nbsp;2616</a>:
   "Hypertext Transfer Protocol - HTTP/1.1",
   IETF Request For Comments, 1999
</dd>
 <dt><a name="rfc3275">[17]</a></dt>
<dd>
   D.&nbsp;Eastlake et al.,
   <a href="http://www.rfc-editor.org/rfc/rfc3275.txt">RFC&nbsp;3275</a>:
   "XML-Signature Syntax and Processing",
   IETF Request For Comments, 2002
</dd>
 <dt><a name="origin">[18]</a></dt>
<dd>
   A.&nbsp;Barth,
   "<a href="http://tools.ietf.org/html/draft-abarth-origin">The Web Origin Concept</a>",
   IETF Draft, 2010
</dd>
 <dt><a name="ucd">[19]</a></dt>
<dd>
   A.&nbsp;Preite&nbsp;Martinez et al.
   "<a href="http://www.ivoa.net/Documents/latest/UCD.html">An IVOA Standard for Unified Content Descriptors</a>",
   IVOA Recommendation, 2007
</dd>
 <dt><a name="docstd">[20]</a></dt>
<dd>
   R.&nbsp;J.&nbsp;Hanisch et al.
   "<a href="http://www.ivoa.net/Documents/latest/DocStd.html">IVOA Document Standards</a>",
   IVOA Recommendation, 2010</dd>
</dl>
<p></p>
<hr>
<h3>Footnotes:</h3>

<p></p>
<a name="tthFtNtAAB"></a><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFrefAAB"><sup>1</sup></a>
   One way a hub might implement this is to generate <em>msg-id </em>
   by concatenating the sender's client ID and the <em>msg-tag </em>.
   When any response is received the hub can then unpack the accompanying
   <em>msg-id </em> to find out who the original sender was and what
   <em>msg-tag </em> it used.  In this way the hub can determine
   how to pass each response back to its correct sender without needing
   to maintain internal state concerning messages in progress.
   Hub and client implementations may wish to exploit this freedom 
   in assigning message IDs for other purposes as well, 
   for instance to incorporate timestamps or checksums.

<p></p>
<a name="tthFtNtAAC"></a><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFrefAAC"><sup>2</sup></a>
   Note to Java developers: contrary to what you might expect,
   the <tt>user.home</tt> system property on Windows does <em>not</em> give you the
   value of <tt>USERPROFILE</tt>.
   See <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4787931"><tt>http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4787931</tt></a>.

<p></p>
<a name="tthFtNtAAD"></a><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFrefAAD"><sup>3</sup></a>Support for the crossdomain.xml
   file is reportedly implemented in Java v1.6.0_10 and later,
   see <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6676256"><tt>http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6676256</tt></a>.
<p></p>
<a name="tthFtNtAAE"></a><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFrefAAE"><sup>4</sup></a>See for instance the
  flXHR library at <a href="http://flxhr.flensed.com/"><tt>http://flxhr.flensed.com/</tt></a>.

<p></p>
<a name="tthFtNtAAF"></a><a href="https://www.ivoa.net/documents/SAMP/20120411/REC-SAMP-1.3-20120411.html#tthFrefAAF"><sup>5</sup></a>See for example
   <a href="http://secunia.com/advisories/22467/"><tt>http://secunia.com/advisories/22467/</tt></a>,
   which refers to a Flash version from 2006.
   Hopefully browsers and plugins in current use do
   not contain such vulnerabilities,
   but an assurance of this is beyond the scope of this document.
<br><br><hr>
<small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 3.80.<br>On 11 Apr 2012, 21:46.</small>


</body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>